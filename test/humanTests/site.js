#!/usr/bin/env node
"use strict";global.__scopedir=__dirname;require("source-map-support").install();const scope=require("/home/spence/Projects/scope/lib/scopeRuntime.js");const ScopeApi=require("/home/spence/Projects/scope/lib/scopeRuntimeApi.js")(scope);module.exports=scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"server",value:scope.import("/home/spence/Projects/scope/packages/serve/main.js")()});scope.declarationExpression({type:"let",name:"db",value:scope.import("/home/spence/Projects/scope/test/humanTests/inc/db.js")});scope.declarationExpression({type:"let",name:"users",value:scope.identifier("db")["collection"]("users")});scope.declarationExpression({type:"let",name:"makeUser",value:scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"newUser",value:scope.mapExpression(["username","bar"],["password","123"],["email","bar@example.com"])});scope.identifier("users")["insert"](scope.identifier("newUser"),scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"err",value:args[0]===undefined?"":args[0]});scope.declarationExpression({type:"let",name:"value",value:args[1]===undefined?"":args[1]});ScopeApi['if'](scope.identifier("err"),scope.createScope((args)=>{ScopeApi.print("insert error:",scope.identifier("err"));}),scope.createScope((args)=>{ScopeApi.print("insert successful:",scope.identifier("value"));}));}));})});scope.declarationExpression({type:"let",name:"findUsers",value:scope.createScope((args)=>{scope.identifier("users")["find"]()["toArray"](scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"err",value:args[0]===undefined?false:args[0]});scope.declarationExpression({type:"let",name:"docs",value:args[1]===undefined?scope.mapExpression():args[1]});ScopeApi['if'](scope.identifier("err"),scope.createScope((args)=>{ScopeApi.print("Find Error:",scope.identifier("err"));}),scope.createScope((args)=>{ScopeApi.print(ScopeApi.BSONtoMap(scope.identifier("docs")));}));}));})});scope.identifier("db")["on"]("error",scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"err",value:args[0]===undefined?"":args[0]});ScopeApi.print("DB Error:",scope.identifier("err"));}));scope.identifier("db")["on"]("connect",scope.createScope((args)=>{ScopeApi.print("DB Connected!");}));scope.declarationExpression({type:"let",name:"template",value:scope.import("/home/spence/Projects/scope/test/humanTests/inc/template.js")});scope.declarationExpression({type:"let",name:"loadPages",value:scope.import("/home/spence/Projects/scope/test/humanTests/inc/loadPages.js")});scope.declarationExpression({type:"let",name:"loader",value:scope.identifier("loadPages")("inc/pages")});scope.assignmentExpression([scope.identifier("template"),"manifest"],["=", scope.mapExpression(["short_name","Scope Test"],["name","Scope Programming Language Test Site"],["start_url","/"],["background_color","#FFFFFF"],["display","standalone"],["scope","/"],["theme_color","#0090D2"])]);scope.assignmentExpression([scope.identifier("template"),"styleLink"],["=", "/styles/main.css"]);scope.assignmentExpression([scope.identifier("template"),"nav"],["=", scope.mapExpression(["Home","/home"],["Documentation","/docs"],["About","/about"],["Contact","/contact"])]);scope.declarationExpression({type:"let",name:"notFound",value:scope.mapExpression(["title","404: Not Found"],["url","404"],["body",scope.xmlExpression("article",{},scope.xmlExpression("h2",{},"We have a problem.."),scope.xmlExpression("div",{},scope.xmlExpression("strong",{},"404 Not Found:")," The requested page was not found."))])});scope.identifier("server")["manifest"](scope.identifier("template")["manifest"]);scope.identifier("server")["get"]("/",scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("client")["response"]["redirect"](301,"/home");}));scope.identifier("server")["get"]("/404",scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("client")["response"]["status"](404);scope.identifier("client")["response"]["render"](scope.identifier("template")["generate"](scope.identifier("notFound")));}));scope.identifier("server")["get"](scope.identifier("template")["styleLink"],scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("client")["response"]["sendStyle"](scope.identifier("template")["stylesheet"]);}));ScopeApi.promise["all"](scope.identifier("loader")["promises"])["then"](scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"pages",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("server")["get"]("/:page",scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.declarationExpression({type:"let",name:"renderred",value:false});ScopeApi['each'](scope.identifier("pages"),scope.createScope((args)=>{scope.declarationExpression({type:"let",name:"sc",value:args[0]===undefined?scope.createScope((args)=>{}):args[0]});scope.declarationExpression({type:"let",name:"name",value:args[1]===undefined?"":args[1]});ScopeApi['if'](scope.binaryExpression('===', scope.identifier("name"), scope.identifier("client")["request"]["params"]["page"]),scope.createScope((args)=>{scope.use([scope.identifier("sc")]);scope.identifier("client")["response"]["render"](scope.identifier("page")(scope.identifier("template")["generate"]),false);scope.assignmentExpression(["renderred"],["=", true]);}));}));ScopeApi['if'](!scope.identifier("renderred"),scope.createScope((args)=>{scope.identifier("client")["response"]["status"](404);scope.identifier("client")["response"]["render"](scope.identifier("template")["generate"](scope.identifier("notFound")));}));}));}));scope.identifier("server")["listen"](scope.mapExpression(["port",8080],["clientScope",true]),scope.createScope((args)=>{ScopeApi.print("Server running on 8080");}));})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3NwZW5jZS9Qcm9qZWN0cy9zY29wZS90ZXN0L2h1bWFuVGVzdHMvc2l0ZS5zYyJdLCJuYW1lcyI6WyI8YW5vbnltb3VzZT4iLCJkYiIsInNjb3BlLmlkZW50aWZpZXIoXCJkYlwiKS5vbiIsImludm9rZUV4cHJlc3Npb24iLCJwcmludCIsImVyciIsInRlbXBsYXRlIiwic2NvcGUuaWRlbnRpZmllcihcInRlbXBsYXRlXCIpLm1hbmlmZXN0Iiwic2NvcGUuaWRlbnRpZmllcihcInRlbXBsYXRlXCIpLnN0eWxlTGluayIsInNjb3BlLmlkZW50aWZpZXIoXCJ0ZW1wbGF0ZVwiKS5uYXYiLCJzZXJ2ZXIiLCJzY29wZS5pZGVudGlmaWVyKFwic2VydmVyXCIpLm1hbmlmZXN0Iiwic2NvcGUuaWRlbnRpZmllcihcInNlcnZlclwiKS5nZXQiLCJjbGllbnQiLCJzY29wZS5pZGVudGlmaWVyKFwiY2xpZW50XCIpLnJlc3BvbnNlIiwic2NvcGUuaWRlbnRpZmllcihcImNsaWVudFwiKVtcInJlc3BvbnNlXCJdLnJlZGlyZWN0Iiwic2NvcGUuaWRlbnRpZmllcihcImNsaWVudFwiKVtcInJlc3BvbnNlXCJdLnN0YXR1cyIsInNjb3BlLmlkZW50aWZpZXIoXCJjbGllbnRcIilbXCJyZXNwb25zZVwiXS5yZW5kZXIiLCJzY29wZS5pZGVudGlmaWVyKFwidGVtcGxhdGVcIikuZ2VuZXJhdGUiLCJub3RGb3VuZCIsInNjb3BlLmlkZW50aWZpZXIoXCJjbGllbnRcIilbXCJyZXNwb25zZVwiXS5zZW5kU3R5bGUiLCJzY29wZS5pZGVudGlmaWVyKFwidGVtcGxhdGVcIikuc3R5bGVzaGVldCIsInByb21pc2UiLCJTY29wZUFwaS5wcm9taXNlLmFsbCIsImxvYWRlciIsInNjb3BlLmlkZW50aWZpZXIoXCJsb2FkZXJcIikucHJvbWlzZXMiLCI8bWFwPi50aGVuIiwidGhlbiIsImVhY2giLCJwYWdlcyIsImlmIiwicGFnZSIsInJlbmRlcnJlZCIsInNjb3BlLmlkZW50aWZpZXIoXCJzZXJ2ZXJcIikubGlzdGVuIl0sIm1hcHBpbmdzIjoiQUFvSCtCQTtBQUFBQSxzUkFqSDVCQSxtSUFFd0JBLGdJQUNNQSwyR0FjR0Esb3VCQVViQSwra0JBT3JCQyxzQkFBQUMsTUFDcUJDLENBRFZILE9BQ1VBLHNIQUFqQkksY0FBaUJELENBQUxILFdBQUtBLENBQUFLLHVCQUFBRixDQUFBSCxHQUFBRyxDQUFBSCxDQUdyQkMsc0JBQUFDLE1BQ29CQyxDQURQSCxTQUNPQSw0QkFBaEJJLGNBQWdCRCxDQUFBSCxlQUFBRyxDQUFBSCxHQUFBRyxDQUFBSCxDQUdpQkEsNElBQ0VBLDhJQUVQQSx5R0FVbENBLDRCQVJRTSw0QkFBQUMsV0FRUlAsNk5BRXVDQSw0QkFBL0JNLDRCQUFBRSxZQUErQlIsNkJBT3ZDQSw0QkFMUU0sNEJBQUFHLE1BS1JULG9IQVl1Q0EsaVZBS2pDVSwwQkFBQUMsWUFBa0JSLENBQUFHLDRCQUFBQyxZQUFBSixDQUFBSCxDQUVsQlUsMEJBQUFFLE9BQ2dDVCxDQUR4QkgsR0FDd0JBLDRJQUEvQmEsMEJBQUFDLFlBQUFDLFlBQStCWixDQUFUSCxHQUFTQSxRQUFBRyxDQUFBSCxHQUFBRyxDQUFBSCxDQUdoQ1UsMEJBQUFFLE9BRTRDVCxDQUZqQ0gsTUFFaUNBLDRJQUQzQ2EsMEJBQUFDLFlBQUFFLFVBQW9CYixDQUFBSCxHQUFBRyxDQUFBSCxDQUNwQmEsMEJBQUFDLFlBQUFHLFVBQTJDZCxDQUFsQkcsNEJBQUFZLFlBQWtCZixDQUFBZ0IsNEJBQUFoQixFQUFBSCxHQUFBRyxDQUFBSCxDQUc1Q1UsMEJBQUFFLE9BQzZCVCxDQURoQkcsNEJBQUFFLGFBQ2dCUiw0SUFBNUJhLDBCQUFBQyxZQUFBTSxhQUE0QmpCLENBQUFHLDRCQUFBZSxjQUFBbEIsQ0FBQUgsR0FBQUcsQ0FBQUgsQ0FFNUJzQixnQkFBQUMsT0FBV3BCLENBQUFxQiwwQkFBQUMsWUFBQXRCLENBQWV1QixFQUFBQyxJQUFBRCxFQVltQnZCLENBQUFILDBJQVg3Q1UsMEJBQUFFLE9BVzZDVCxDQVhoQ0gsUUFXZ0NBLDRJQVY3QkEsdUVBQ2pCNEIsZ0JBSWN6QixDQUpSMEIseUJBSVE3QiwyT0FIZDhCLGNBR2MzQixDQUhDSCxnSEFHREEsNEJBRlZBLG9DQUNBYSwwQkFBQUMsWUFBQUcsVUFBK0NkLENBQTFCNEIsd0JBQVM1QixDQUFBRyw0QkFBQVksWUFBQWYsQ0FBaUJILE1BQUFHLENBQUFILENBQ3JDQSw0QkFBTmdDLFdBQU1oQyxpQkFBQUcsQ0FBQUgsR0FBQUcsQ0FBQUgsQ0FHZjhCLGNBRStDM0IsQ0FGcENILENBQUFnQyw2QkFFb0NoQyw0QkFEM0NhLDBCQUFBQyxZQUFBRSxVQUFvQmIsQ0FBQUgsR0FBQUcsQ0FBQUgsQ0FDcEJhLDBCQUFBQyxZQUFBRyxVQUEyQ2QsQ0FBbEJHLDRCQUFBWSxZQUFrQmYsQ0FBQWdCLDRCQUFBaEIsRUFBQUgsR0FBQUcsQ0FBQUgsR0FBQUcsQ0FBQUgsR0FBQUcsQ0FBQUgsQ0FLOUNVLDBCQUFBdUIsVUFDeUI5QixDQURhSCx1REFDYkEsNEJBQXpCSSxjQUF5QkQsQ0FBQUgsd0JBQUFHLENBQUFILEdBQUFHLENBQUFILEdBQUFHLEVBQUFIIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNlcnZlciA9IGltcG9ydCBcInNlcnZlXCIoLypbXG5cdGtleTogXCJsaWIvc2VydmVyLmtleVwiLFxuXHRjZXJ0OiBcImxpYi9zZXJ2ZXIuY2VydFwiXG5dKi8pO1xuXG5sZXQgZGIgPSBpbXBvcnQgXCJpbmMvZGIuc2NcIjtcbmxldCB1c2VycyA9IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcblxuLy8gZm9yIHNvbWUgcmVhc29uLi4gdGhpcyBhY3R1YWxseSB3b3JrcyA/Pz8gQ29vbCEgPURcbmxldCBtYWtlVXNlciA9IHtcblx0bGV0IG5ld1VzZXIgPSBbXG5cdFx0dXNlcm5hbWU6IFwiYmFyXCIsXG5cdFx0cGFzc3dvcmQ6IFwiMTIzXCIsXG5cdFx0ZW1haWw6IFwiYmFyQGV4YW1wbGUuY29tXCJcblx0XTtcblxuXHR1c2Vycy5pbnNlcnQobmV3VXNlciwgKGVycjogXCJcIiwgdmFsdWU6IFwiXCIpIHtcblx0XHRpZihlcnIsIHtcblx0XHRcdHByaW50KFwiaW5zZXJ0IGVycm9yOlwiLCBlcnIpO1xuXHRcdH0sIHtcblx0XHRcdHByaW50KFwiaW5zZXJ0IHN1Y2Nlc3NmdWw6XCIsIHZhbHVlKTtcblx0XHR9KTtcblx0fSk7XG59O1xuXG5sZXQgZmluZFVzZXJzID0ge1xuXHR1c2Vycy5maW5kKCkudG9BcnJheSgoZXJyOiBmYWxzZSwgZG9jczogW10pIHtcblx0XHRpZiAoZXJyLCB7XG5cdFx0XHRwcmludChcIkZpbmQgRXJyb3I6XCIsIGVycik7XG5cdFx0fSwge1xuXHRcdFx0cHJpbnQoQlNPTnRvTWFwKGRvY3MpKTtcblx0XHR9KTtcblx0fSk7XG59O1xuLy9tYWtlVXNlcigpOyAvLyA8LS0gd29ya3Ncbi8vZmluZFVzZXJzKCk7IC8vIDwtLSB3b3Jrc1xuXG5kYi5vbihcImVycm9yXCIsIChlcnI6IFwiXCIpIHtcblx0cHJpbnQoXCJEQiBFcnJvcjpcIiwgZXJyKTtcbn0pO1xuXG5kYi5vbihcImNvbm5lY3RcIiwge1xuXHRwcmludChcIkRCIENvbm5lY3RlZCFcIik7XG59KTtcblxubGV0IHRlbXBsYXRlID0gaW1wb3J0IFwiaW5jL3RlbXBsYXRlLnNjXCI7XG5sZXQgbG9hZFBhZ2VzID0gaW1wb3J0IFwiaW5jL2xvYWRQYWdlcy5zY1wiO1xuXG5sZXQgbG9hZGVyID0gbG9hZFBhZ2VzKFwiaW5jL3BhZ2VzXCIpO1xuXG50ZW1wbGF0ZS5tYW5pZmVzdCA9IFtcblx0c2hvcnRfbmFtZTogXCJTY29wZSBUZXN0XCIsXG5cdG5hbWU6IFwiU2NvcGUgUHJvZ3JhbW1pbmcgTGFuZ3VhZ2UgVGVzdCBTaXRlXCIsXG5cdHN0YXJ0X3VybDogXCIvXCIsXG5cdGJhY2tncm91bmRfY29sb3I6IFwiI0ZGRkZGRlwiLFxuXHRkaXNwbGF5OiBcInN0YW5kYWxvbmVcIixcblx0c2NvcGU6IFwiL1wiLFxuXHR0aGVtZV9jb2xvcjogXCIjMDA5MEQyXCJcbl07XG5cbnRlbXBsYXRlLnN0eWxlTGluayA9IFwiL3N0eWxlcy9tYWluLmNzc1wiO1xuXG50ZW1wbGF0ZS5uYXYgPSBbXG5cdEhvbWU6IFwiL2hvbWVcIixcblx0RG9jdW1lbnRhdGlvbjogXCIvZG9jc1wiLFxuXHRBYm91dDogXCIvYWJvdXRcIixcblx0Q29udGFjdDogXCIvY29udGFjdFwiXG5dO1xuXG5sZXQgbm90Rm91bmQgPSBbXG5cdHRpdGxlOiBcIjQwNDogTm90IEZvdW5kXCIsXG5cdHVybDogXCI0MDRcIixcblx0Ym9keTogXG5cdDxhcnRpY2xlPlxuXHRcdDxoMj5cblx0XHRcdFwiV2UgaGF2ZSBhIHByb2JsZW0uLlwiO1xuXHRcdDwvaDI+O1xuXHRcdDxkaXY+XG5cdFx0XHQ8c3Ryb25nPlwiNDA0IE5vdCBGb3VuZDpcIjs8L3N0cm9uZz47XG5cdFx0XHRcIiBUaGUgcmVxdWVzdGVkIHBhZ2Ugd2FzIG5vdCBmb3VuZC5cIjtcblx0XHQ8L2Rpdj47XG5cdDwvYXJ0aWNsZT5cbl07XG5cbnNlcnZlci5tYW5pZmVzdCh0ZW1wbGF0ZS5tYW5pZmVzdCk7XG5cbnNlcnZlci5nZXQoXCIvXCIsIChjbGllbnQ6IFtdKSB7XG5cdGNsaWVudC5yZXNwb25zZS5yZWRpcmVjdCgzMDEsIFwiL2hvbWVcIik7XG59KTtcblxuc2VydmVyLmdldChcIi80MDRcIiwgKGNsaWVudDogW10pIHtcblx0Y2xpZW50LnJlc3BvbnNlLnN0YXR1cyg0MDQpO1xuXHRjbGllbnQucmVzcG9uc2UucmVuZGVyKHRlbXBsYXRlLmdlbmVyYXRlKG5vdEZvdW5kKSk7XG59KTtcblxuc2VydmVyLmdldCh0ZW1wbGF0ZS5zdHlsZUxpbmssIChjbGllbnQ6IFtdKSB7XG5cdGNsaWVudC5yZXNwb25zZS5zZW5kU3R5bGUodGVtcGxhdGUuc3R5bGVzaGVldCk7XG59KTtcbnByb21pc2UuYWxsKGxvYWRlci5wcm9taXNlcykudGhlbigocGFnZXM6IFtdKSB7XG5cdHNlcnZlci5nZXQoXCIvOnBhZ2VcIiwgKGNsaWVudDogW10pIHtcblx0XHRsZXQgcmVuZGVycmVkID0gZmFsc2U7XG5cdFx0ZWFjaChwYWdlcywgKHNjOiB7fSwgbmFtZTogXCJcIikge1xuXHRcdFx0aWYgKG5hbWUgaXMgY2xpZW50LnJlcXVlc3QucGFyYW1zLnBhZ2UsIHtcblx0XHRcdFx0dXNlIHNjO1xuXHRcdFx0XHRjbGllbnQucmVzcG9uc2UucmVuZGVyKHBhZ2UodGVtcGxhdGUuZ2VuZXJhdGUpLCBmYWxzZSk7XG5cdFx0XHRcdHJlbmRlcnJlZCA9IHRydWU7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHRpZiAoIXJlbmRlcnJlZCwge1xuXHRcdFx0Y2xpZW50LnJlc3BvbnNlLnN0YXR1cyg0MDQpO1xuXHRcdFx0Y2xpZW50LnJlc3BvbnNlLnJlbmRlcih0ZW1wbGF0ZS5nZW5lcmF0ZShub3RGb3VuZCkpO1xuXHRcdH0pO1xuXHR9KTtcbn0pO1xuXG5zZXJ2ZXIubGlzdGVuKFtwb3J0OiA4MDgwLCBjbGllbnRTY29wZTogdHJ1ZV0sIHtcblx0cHJpbnQoXCJTZXJ2ZXIgcnVubmluZyBvbiA4MDgwXCIpO1xufSk7Il19