#!/usr/bin/env node
"use strict";global.__scopedir=__dirname;require("source-map-support").install();const scope=require("/home/spence/Projects/scope/lib/scopeRuntime.js");const ScopeApi=require("/home/spence/Projects/scope/lib/scopeRuntimeApi.js")(scope);module.exports=scope.createScope(function(args){scope.declarationExpression({type:"let",name:"server",value:scope.import("/home/spence/Projects/scope/packages/serve/main.js")()});scope.declarationExpression({type:"let",name:"db",value:scope.import("/home/spence/Projects/scope/test/humanTests/inc/db.js")});scope.declarationExpression({type:"let",name:"tellServer",value:scope.createScope(function(args){scope.declarationExpression({type:"let",name:"event",value:args[0]===undefined?scope.mapExpression():args[0]});ScopeApi.print(scope.identifier("event"));scope.identifier("event")["preventDefault"]();scope.declarationExpression({type:"let",name:"data",value:scope.mapExpression(["username",scope.identifier("event")["target"]["username"]["value"]],["password",scope.identifier("event")["target"]["password"]["value"]])});ScopeApi.print(scope.identifier("data"));scope.identifier("socket")["emit"]("register",scope.identifier("data"));return false;})});scope.declarationExpression({type:"let",name:"userPattern",value:/^[a-zA-Z0-9-_]{3,32}$/});scope.declarationExpression({type:"let",name:"passPattern",value:/^(?=.*[a-zA-Z]+)(?=.*[0-9]+)(?=.*[^a-zA-Z0-9]).{3,32}$/});scope.declarationExpression({type:"let",name:"makeUserForm",value:scope.xmlExpression("form",{"onSubmit":scope.identifier("tellServer")},scope.xmlExpression("label",{"for":"username"},"Usernames may have 3-32 letters, numbers, hyphens (-) and underscores (_)."),scope.xmlExpression("br",{}),scope.xmlExpression("input",{"id":"username", "name":"username", "placeholder":"Username", "pattern":scope.identifier("userPattern"), "minlength":3, "maxLength":32, "required":true}),scope.xmlExpression("br",{}),scope.xmlExpression("label",{"for":"password"},"Passwords may have 3-32 characters- but must contain at least 1 letter, 1 number, and 1 special character."),scope.xmlExpression("br",{}),scope.xmlExpression("input",{"id":"password", "type":"password", "name":"password", "placeholder":"Password", "pattern":scope.identifier("passPattern"), "minlength":3, "maxLength":32, "required":true}),scope.xmlExpression("br",{}),scope.xmlExpression("input",{"id":"email", "type":"email", "name":"email", "placeholder":"Email"}),scope.xmlExpression("input",{"type":"submit"},"Register"))});scope.declarationExpression({type:"let",name:"page",value:scope.xmlExpression("html",{},scope.xmlExpression("head",{},scope.xmlExpression("title",{},"register")),scope.xmlExpression("body",{},scope.xmlExpression("div",{"bind-out":"register"}),scope.identifier("makeUserForm")))});scope.identifier("server")["on"]("register",scope.createScope(function(args){scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.declarationExpression({type:"let",name:"data",value:args[1]===undefined?scope.mapExpression():args[1]});ScopeApi['if'](scope.identifier("data")["has"]("error"),scope.createScope(function(args){ScopeApi.print(scope.identifier("data")["error"]);scope.identifier("client")["emit"]("register","Something went wrong..");}),scope.createScope(function(args){scope.declarationExpression({type:"let",name:"cont",value:scope.binaryExpression('&&', scope.identifier("data")["has"]("username"), scope.binaryExpression('>', scope.identifier("data")["username"]["length"], 2))});scope.assignmentExpression(["cont"],["=", scope.binaryExpression('&&', scope.identifier("cont"), scope.identifier("userPattern")["test"](scope.identifier("data")["username"]))]);scope.assignmentExpression(["cont"],["=", scope.binaryExpression('&&', scope.binaryExpression('&&', scope.identifier("cont"), scope.identifier("data")["has"]("password")), scope.binaryExpression('>', scope.identifier("data")["password"]["length"], 2))]);scope.assignmentExpression(["cont"],["=", scope.binaryExpression('&&', scope.identifier("cont"), scope.identifier("passPattern")["test"](scope.identifier("data")["password"]))]);scope.declarationExpression({type:"let",name:"text",value:ScopeApi['if'](scope.identifier("cont"),scope.createScope(function(args){return scope.xmlExpression("span",{"style":scope.mapExpression(["color","green"],["font-weight","bold"])},"Registration passes criteria.");}),scope.createScope(function(args){return scope.xmlExpression("span",{"style":scope.mapExpression(["color","red"],["font-weight","bold"])},"Registration doesn't pass criteria. Username and Password must be at least 3 characters long.");}))});scope.identifier("client")["emit"]("register",scope.identifier("text"));}));}));scope.identifier("server")["get"]("/",scope.createScope(function(args){scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("client")["response"]["render"](scope.identifier("page"));}));scope.identifier("server")["listen"](scope.mapExpression(["port",8000],["clientScope",true]));})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3NwZW5jZS9Qcm9qZWN0cy9zY29wZS90ZXN0L2h1bWFuVGVzdHMvbmV3U2l0ZS5zYyJdLCJuYW1lcyI6WyI8YW5vbnltb3VzZT4iLCJzZXJ2ZXIiLCJzY29wZS5pZGVudGlmaWVyKFwic2VydmVyXCIpLm9uIiwiaW52b2tlRXhwcmVzc2lvbiIsImlmIiwiZGF0YSIsInNjb3BlLmlkZW50aWZpZXIoXCJkYXRhXCIpLmhhcyIsInByaW50Iiwic2NvcGUuaWRlbnRpZmllcihcImRhdGFcIikuZXJyb3IiLCJjbGllbnQiLCJzY29wZS5pZGVudGlmaWVyKFwiY2xpZW50XCIpLmVtaXQiLCJjb250IiwidGV4dCIsInNjb3BlLmlkZW50aWZpZXIoXCJzZXJ2ZXJcIikuZ2V0Iiwic2NvcGUuaWRlbnRpZmllcihcImNsaWVudFwiKS5yZXNwb25zZSIsInNjb3BlLmlkZW50aWZpZXIoXCJjbGllbnRcIilbXCJyZXNwb25zZVwiXS5yZW5kZXIiLCJwYWdlIiwic2NvcGUuaWRlbnRpZmllcihcInNlcnZlclwiKS5saXN0ZW4iXSwibWFwcGluZ3MiOiJBQTZFNENBO0FBQUFBLDRSQTdFaEJBLG1JQUNEQSxnSUFZYkEsd29CQUUyQkEsMkZBQ2lDQSw0SEFnQjFDQSx3akNBU25CQSx3UkFJUEMsMEJBQUFDLE1Bd0J3QkMsQ0F4QlZILFVBd0JVQSxnUUF2QjFCSSxjQXVCMEJELENBdkJyQkUsd0JBQUFDLE9BQVlILENBQUFILE9BQUFHLENBdUJTSCxDQXJCb0JBLGlDQUQzQ08sY0FBS0osQ0FBQUUsd0JBQUFHLFNBQUFMLENBQUFILENBQ0pTLDBCQUFBQyxRQUEwQ1AsQ0FBMUJILFVBQTBCQSx5QkFBQUcsQ0FBQUgsR0FxQnBCQSxrQ0FuQmlDQSxzTkFDeEJBLDRCQUFoQ1csTUFBZ0NYLGdKQUM2QkEsNEJBQTdEVyxNQUE2RFgsNE5BQzdCQSw0QkFBaENXLE1BQWdDWCxnSkFhNERBLGlnQkFHM0ZTLDBCQUFBQyxRQUFzQlAsQ0FBTkgsVUFBTUEsQ0FBQVksd0JBQUFULENBQUFILEdBQUFHLENBQUFILEdBQUFHLENBQUFILENBSXhCQywwQkFBQVksT0FDc0JWLENBRGRILEdBQ2NBLGtKQUFyQlMsMEJBQUFLLFlBQUFDLFVBQXFCWixDQUFBYSx3QkFBQWIsQ0FBQUgsR0FBQUcsQ0FBQUgsQ0FHdEJDLDBCQUFBZ0IsVUFBc0NkLENBQUFILHVEQUFBRyxDQUFBSCxHQUFBRyxFQUFBSCIsInNvdXJjZXNDb250ZW50IjpbImxldCBzZXJ2ZXIgPSBpbXBvcnQgXCJzZXJ2ZVwiKCk7XG5sZXQgZGIgPSBpbXBvcnQgXCJpbmMvZGIuc2NcIjtcblxuXG5sZXQgdGVsbFNlcnZlciA9IChldmVudDogW10pIHtcblx0XHRwcmludChldmVudCk7XG5cdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRsZXQgZGF0YSA9IFtcblx0XHRcdHVzZXJuYW1lOiBldmVudC50YXJnZXQudXNlcm5hbWUudmFsdWUsXG5cdFx0XHRwYXNzd29yZDogZXZlbnQudGFyZ2V0LnBhc3N3b3JkLnZhbHVlXG5cdFx0XTtcblx0XHRwcmludChkYXRhKTtcblx0XHRzb2NrZXQuZW1pdChcInJlZ2lzdGVyXCIsIGRhdGEpO1xuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcbmxldCB1c2VyUGF0dGVybiA9IC9eW2EtekEtWjAtOS1fXXszLDMyfSQvO1xubGV0IHBhc3NQYXR0ZXJuID0gL14oPz0uKlthLXpBLVpdKykoPz0uKlswLTldKykoPz0uKlteYS16QS1aMC05XSkuezMsMzJ9JC87XG5sZXQgbWFrZVVzZXJGb3JtID0gXG48Zm9ybSBvblN1Ym1pdD10ZWxsU2VydmVyPlxuXHQ8bGFiZWwgZm9yPVwidXNlcm5hbWVcIj5cblx0XHRcIlVzZXJuYW1lcyBtYXkgaGF2ZSAzLTMyIGxldHRlcnMsIG51bWJlcnMsIGh5cGhlbnMgKC0pIGFuZCB1bmRlcnNjb3JlcyAoXykuXCI7XG5cdDwvbGFiZWw+O1xuXHQ8YnIgLz47XG5cdDxpbnB1dCBpZD1cInVzZXJuYW1lXCIgbmFtZT1cInVzZXJuYW1lXCIgcGxhY2Vob2xkZXI9XCJVc2VybmFtZVwiIHBhdHRlcm49dXNlclBhdHRlcm4gbWlubGVuZ3RoPTMgbWF4TGVuZ3RoPTMyIHJlcXVpcmVkPXRydWUgLz47XG5cdDxiciAvPjtcblx0PGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+XG5cdFx0XCJQYXNzd29yZHMgbWF5IGhhdmUgMy0zMiBjaGFyYWN0ZXJzLSBidXQgbXVzdCBjb250YWluIGF0IGxlYXN0IDEgbGV0dGVyLCAxIG51bWJlciwgYW5kIDEgc3BlY2lhbCBjaGFyYWN0ZXIuXCI7XG5cdDwvbGFiZWw+O1xuXHQ8YnIgLz47XG5cdDxpbnB1dCBpZD1cInBhc3N3b3JkXCIgdHlwZT1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcGxhY2Vob2xkZXI9XCJQYXNzd29yZFwiIHBhdHRlcm49cGFzc1BhdHRlcm4gbWlubGVuZ3RoPTMgbWF4TGVuZ3RoPTMyIHJlcXVpcmVkPXRydWUgLz47XG5cdDxiciAvPjtcblx0PGlucHV0IGlkPVwiZW1haWxcIiB0eXBlPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiBwbGFjZWhvbGRlcj1cIkVtYWlsXCIgLz47XG5cdDxpbnB1dCB0eXBlPVwic3VibWl0XCI+XCJSZWdpc3RlclwiOzwvYnV0dG9uPjtcbjwvZm9ybT47XG5cbmxldCBwYWdlID0gPGh0bWw+XG48aGVhZD5cblx0PHRpdGxlPlwicmVnaXN0ZXJcIjs8L3RpdGxlPjtcbjwvaGVhZD47XG48Ym9keT5cblx0PGRpdiBiaW5kLW91dD1cInJlZ2lzdGVyXCIgLz47XG5cdG1ha2VVc2VyRm9ybTtcbjwvYm9keT47XG48L2h0bWw+O1xuXG5zZXJ2ZXIub24oXCJyZWdpc3RlclwiLCAoY2xpZW50OiBbXSwgZGF0YTogW10pIHtcblx0aWYgKGRhdGEuaGFzKFwiZXJyb3JcIiksIHtcblx0XHRwcmludChkYXRhLmVycm9yKTtcblx0XHRjbGllbnQuZW1pdChcInJlZ2lzdGVyXCIsIFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuLlwiKTtcblx0fSwge1xuXHRcdGxldCBjb250ID0gZGF0YS5oYXMoXCJ1c2VybmFtZVwiKSBhbmQgZGF0YS51c2VybmFtZS5sZW5ndGggZ3QgMjtcblx0XHRjb250ID0gY29udCBhbmQgdXNlclBhdHRlcm4udGVzdChkYXRhLnVzZXJuYW1lKTtcblx0XHRjb250ID0gY29udCBhbmQgZGF0YS5oYXMoXCJwYXNzd29yZFwiKSBhbmQgZGF0YS5wYXNzd29yZC5sZW5ndGggZ3QgMjtcblx0XHRjb250ID0gY29udCBhbmQgcGFzc1BhdHRlcm4udGVzdChkYXRhLnBhc3N3b3JkKTtcblx0XHRsZXQgdGV4dCA9IGlmIChjb250LCB7XG5cdFx0XHRyZXR1cm4gXG5cdFx0XHQ8c3BhbiBzdHlsZT1bXG5cdFx0XHRcdGNvbG9yOiBcImdyZWVuXCIsXG5cdFx0XHRcdGZvbnQtd2VpZ2h0OiBcImJvbGRcIl0+XG5cdFx0XHRcdFwiUmVnaXN0cmF0aW9uIHBhc3NlcyBjcml0ZXJpYS5cIjtcblx0XHRcdDwvc3Bhbj47XG5cdFx0fSwge1xuXHRcdFx0cmV0dXJuIFxuXHRcdFx0PHNwYW4gc3R5bGU9W1xuXHRcdFx0XHRjb2xvcjogXCJyZWRcIiwgXG5cdFx0XHRcdGZvbnQtd2VpZ2h0OiBcImJvbGRcIl0+XG5cdFx0XHRcdFwiUmVnaXN0cmF0aW9uIGRvZXNuJ3QgcGFzcyBjcml0ZXJpYS4gVXNlcm5hbWUgYW5kIFBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzIGxvbmcuXCI7XG5cdFx0XHQ8L3NwYW4+O1xuXHRcdH0pO1xuXHRcdGNsaWVudC5lbWl0KFwicmVnaXN0ZXJcIiwgdGV4dCk7XG5cdH0pO1xufSk7XG5cbnNlcnZlci5nZXQoXCIvXCIsIChjbGllbnQ6IFtdKSB7XG5cdGNsaWVudC5yZXNwb25zZS5yZW5kZXIocGFnZSk7XG59KTtcblxuc2VydmVyLmxpc3RlbihbcG9ydDogODAwMCwgY2xpZW50U2NvcGU6IHRydWVdKTsiXX0=