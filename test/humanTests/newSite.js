#!/usr/bin/env node
"use strict";global.__scopedir=__dirname;require("source-map-support").install();const scope=require("/home/spence/Projects/scope/lib/scopeRuntime.js");const ScopeApi=require("/home/spence/Projects/scope/lib/scopeRuntimeApi.js")(scope);module.exports=scope.createScope(function(args){scope.declarationExpression({type:"let",name:"server",value:scope.import("/home/spence/Projects/scope/packages/serve/main.js")()});scope.declarationExpression({type:"let",name:"tellServer",value:scope.createScope(function(args){scope.declarationExpression({type:"let",name:"event",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("event")["preventDefault"]();scope.declarationExpression({type:"let",name:"data",value:scope.mapExpression(["username",scope.identifier("event")["target"]["username"]["value"]],["password",scope.identifier("event")["target"]["password"]["value"]])});scope.identifier("socket")["emit"]("register",scope.identifier("data"));return false;})});scope.declarationExpression({type:"let",name:"userPattern",value:/^[a-zA-Z0-9-_]{3,32}$/});scope.declarationExpression({type:"let",name:"passPattern",value:/^(?=.*[a-zA-Z]+)(?=.*[0-9]+)(?=.*[^a-zA-Z0-9]).{3,32}$/});scope.declarationExpression({type:"let",name:"makeUserForm",value:scope.xmlExpression("form",{"onSubmit":scope.identifier("tellServer")},scope.xmlExpression("label",{"for":"username"},"Usernames may have 3-32 letters, numbers, hyphens (-) and underscores (_)."),scope.xmlExpression("br",{}),scope.xmlExpression("input",{"id":"username", "name":"username", "placeholder":"Username", "pattern":scope.identifier("userPattern"), "minlength":3, "maxLength":32, "required":true}),scope.xmlExpression("br",{}),scope.xmlExpression("label",{"for":"password"},"Passwords may have 3-32 characters- but must contain at least 1 letter, 1 number, and 1 special character."),scope.xmlExpression("br",{}),scope.xmlExpression("input",{"id":"password", "type":"password", "name":"password", "placeholder":"Password", "pattern":scope.identifier("passPattern"), "minlength":3, "maxLength":32, "required":true}),scope.xmlExpression("br",{}),scope.xmlExpression("button",{"type":"submit"},"Register"))});scope.declarationExpression({type:"let",name:"page",value:scope.xmlExpression("html",{},scope.xmlExpression("head",{},scope.xmlExpression("title",{},"register")),scope.xmlExpression("body",{},scope.xmlExpression("div",{"bind-out":"register"}),scope.identifier("makeUserForm")))});scope.identifier("server")["on"]("register",scope.createScope(function(args){scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.declarationExpression({type:"let",name:"data",value:args[1]===undefined?scope.mapExpression():args[1]});ScopeApi['if'](scope.identifier("data")["has"]("error"),scope.createScope(function(args){ScopeApi.print(scope.identifier("data")["error"]);scope.identifier("client")["emit"]("register","Something went wrong..");}),scope.createScope(function(args){scope.declarationExpression({type:"let",name:"cond",value:scope.identifier("data")["has"]("username")});scope.assignmentExpression(["cond"],["=", scope.binaryExpression('&&', scope.identifier("cond"), scope.identifier("userPattern")["test"](scope.identifier("data")["username"]))]);scope.assignmentExpression(["cond"],["=", scope.binaryExpression('&&', scope.identifier("cond"), scope.identifier("data")["has"]("password"))]);scope.assignmentExpression(["cond"],["=", scope.binaryExpression('&&', scope.identifier("cond"), scope.identifier("passPattern")["test"](scope.identifier("data")["password"]))]);scope.declarationExpression({type:"let",name:"text",value:ScopeApi['if'](scope.identifier("cond"),scope.createScope(function(args){return scope.xmlExpression("span",{"style":scope.mapExpression(["color","green"],["font-weight","bold"])},"Registration passes criteria.");}),scope.createScope(function(args){return scope.xmlExpression("span",{"style":scope.mapExpression(["color","red"],["font-weight","bold"])},"Registration doesn't pass criteria. Username and Password must be at least 3 characters long.");}))});scope.identifier("client")["emit"]("register",scope.identifier("text"));}));}));scope.identifier("server")["get"]("/",scope.createScope(function(args){scope.declarationExpression({type:"let",name:"client",value:args[0]===undefined?scope.mapExpression():args[0]});scope.identifier("client")["response"]["render"](scope.identifier("page"));}));scope.identifier("server")["listen"](scope.mapExpression(["port",8000],["clientScope",true]));})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3NwZW5jZS9Qcm9qZWN0cy9zY29wZS90ZXN0L2h1bWFuVGVzdHMvbmV3U2l0ZS5zYyJdLCJuYW1lcyI6WyI8YW5vbnltb3VzZT4iLCJzZXJ2ZXIiLCJzY29wZS5pZGVudGlmaWVyKFwic2VydmVyXCIpLm9uIiwiaW52b2tlRXhwcmVzc2lvbiIsImlmIiwiZGF0YSIsInNjb3BlLmlkZW50aWZpZXIoXCJkYXRhXCIpLmhhcyIsInByaW50Iiwic2NvcGUuaWRlbnRpZmllcihcImRhdGFcIikuZXJyb3IiLCJjbGllbnQiLCJzY29wZS5pZGVudGlmaWVyKFwiY2xpZW50XCIpLmVtaXQiLCJjb25kIiwidGV4dCIsInNjb3BlLmlkZW50aWZpZXIoXCJzZXJ2ZXJcIikuZ2V0Iiwic2NvcGUuaWRlbnRpZmllcihcImNsaWVudFwiKS5yZXNwb25zZSIsInNjb3BlLmlkZW50aWZpZXIoXCJjbGllbnRcIilbXCJyZXNwb25zZVwiXS5yZW5kZXIiLCJwYWdlIiwic2NvcGUuaWRlbnRpZmllcihcInNlcnZlclwiKS5saXN0ZW4iXSwibWFwcGluZ3MiOiJBQXlGNENBO0FBQUFBLDRSQXpGaEJBLG1JQVNmQSxxakJBRTRCQSwyRkFDaUNBLDRIQWdDekNBLHM5QkFTcEJBLHdSQUlQQywwQkFBQUMsTUF3QndCQyxDQXhCVkgsVUF3QlVBLGdRQXZCMUJJLGNBdUIwQkQsQ0F2QnJCRSx3QkFBQUMsT0FBWUgsQ0FBQUgsT0FBQUcsQ0F1QlNILENBckJvQkEsaUNBRDNDTyxjQUFLSixDQUFBRSx3QkFBQUcsU0FBQUwsQ0FBQUgsQ0FDSlMsMEJBQUFDLFFBQTBDUCxDQUExQkgsVUFBMEJBLHlCQUFBRyxDQUFBSCxHQXFCcEJBLGtDQW5CRUEsd0dBQ09BLDRCQUFoQ1csTUFBZ0NYLGdKQUNGQSw0QkFBOUJXLE1BQThCWCw4R0FDRUEsNEJBQWhDVyxNQUFnQ1gsZ0pBYTREQSxpZ0JBRzNGUywwQkFBQUMsUUFBc0JQLENBQU5ILFVBQU1BLENBQUFZLHdCQUFBVCxDQUFBSCxHQUFBRyxDQUFBSCxHQUFBRyxDQUFBSCxDQUl4QkMsMEJBQUFZLE9BQ3NCVixDQURkSCxHQUNjQSxrSkFBckJTLDBCQUFBSyxZQUFBQyxVQUFxQlosQ0FBQWEsd0JBQUFiLENBQUFILEdBQUFHLENBQUFILENBR3RCQywwQkFBQWdCLFVBQXNDZCxDQUFBSCx1REFBQUcsQ0FBQUgsR0FBQUcsRUFBQUgiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgc2VydmVyID0gaW1wb3J0IFwic2VydmVcIigpO1xuXG5sZXQgdGVsbFNlcnZlciA9IChldmVudDogW10pIHtcblx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0bGV0IGRhdGEgPSBbXG5cdFx0dXNlcm5hbWU6IGV2ZW50LnRhcmdldC51c2VybmFtZS52YWx1ZSxcblx0XHRwYXNzd29yZDogZXZlbnQudGFyZ2V0LnBhc3N3b3JkLnZhbHVlXG5cdF07XG5cdHNvY2tldC5lbWl0KFwicmVnaXN0ZXJcIiwgZGF0YSk7XG5cdHJldHVybiBmYWxzZTtcbn07XG5sZXQgdXNlclBhdHRlcm4gPSAvXlthLXpBLVowLTktX117MywzMn0kLztcbmxldCBwYXNzUGF0dGVybiA9IC9eKD89LipbYS16QS1aXSspKD89LipbMC05XSspKD89LipbXmEtekEtWjAtOV0pLnszLDMyfSQvO1xubGV0IG1ha2VVc2VyRm9ybSA9IFxuPGZvcm0gb25TdWJtaXQ9dGVsbFNlcnZlcj5cblx0PGxhYmVsIGZvcj1cInVzZXJuYW1lXCI+XG5cdFx0XCJVc2VybmFtZXMgbWF5IGhhdmUgMy0zMiBsZXR0ZXJzLCBudW1iZXJzLCBoeXBoZW5zICgtKSBhbmQgdW5kZXJzY29yZXMgKF8pLlwiO1xuXHQ8L2xhYmVsPjtcblx0PGJyIC8+O1xuXHQ8aW5wdXQgXG5cdFx0aWQ9XCJ1c2VybmFtZVwiIFxuXHRcdG5hbWU9XCJ1c2VybmFtZVwiIFxuXHRcdHBsYWNlaG9sZGVyPVwiVXNlcm5hbWVcIiBcblx0XHRwYXR0ZXJuPXVzZXJQYXR0ZXJuIFxuXHRcdG1pbmxlbmd0aD0zIFxuXHRcdG1heExlbmd0aD0zMiBcblx0XHRyZXF1aXJlZD10cnVlIFxuXHQvPjtcblx0PGJyIC8+O1xuXHQ8bGFiZWwgZm9yPVwicGFzc3dvcmRcIj5cblx0XHRcIlBhc3N3b3JkcyBtYXkgaGF2ZSAzLTMyIGNoYXJhY3RlcnMtIGJ1dCBtdXN0IGNvbnRhaW4gYXQgbGVhc3QgMSBsZXR0ZXIsIDEgbnVtYmVyLCBhbmQgMSBzcGVjaWFsIGNoYXJhY3Rlci5cIjtcblx0PC9sYWJlbD47XG5cdDxiciAvPjtcblx0PGlucHV0IFxuXHRcdGlkPVwicGFzc3dvcmRcIiBcblx0XHR0eXBlPVwicGFzc3dvcmRcIiBcblx0XHRuYW1lPVwicGFzc3dvcmRcIiBcblx0XHRwbGFjZWhvbGRlcj1cIlBhc3N3b3JkXCIgXG5cdFx0cGF0dGVybj1wYXNzUGF0dGVybiBcblx0XHRtaW5sZW5ndGg9MyBcblx0XHRtYXhMZW5ndGg9MzIgXG5cdFx0cmVxdWlyZWQ9dHJ1ZSBcblx0Lz47XG5cdDxiciAvPjtcblx0PGJ1dHRvbiB0eXBlPVwic3VibWl0XCI+XCJSZWdpc3RlclwiOzwvYnV0dG9uPjtcbjwvZm9ybT47XG5cbmxldCBwYWdlID0gPGh0bWw+XG48aGVhZD5cblx0PHRpdGxlPlwicmVnaXN0ZXJcIjs8L3RpdGxlPjtcbjwvaGVhZD47XG48Ym9keT5cblx0PGRpdiBiaW5kLW91dD1cInJlZ2lzdGVyXCIgLz47XG5cdG1ha2VVc2VyRm9ybTtcbjwvYm9keT47XG48L2h0bWw+O1xuXG5zZXJ2ZXIub24oXCJyZWdpc3RlclwiLCAoY2xpZW50OiBbXSwgZGF0YTogW10pIHtcblx0aWYgKGRhdGEuaGFzKFwiZXJyb3JcIiksIHtcblx0XHRwcmludChkYXRhLmVycm9yKTtcblx0XHRjbGllbnQuZW1pdChcInJlZ2lzdGVyXCIsIFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuLlwiKTtcblx0fSwge1xuXHRcdGxldCBjb25kID0gZGF0YS5oYXMoXCJ1c2VybmFtZVwiKTtcblx0XHRjb25kID0gY29uZCBhbmQgdXNlclBhdHRlcm4udGVzdChkYXRhLnVzZXJuYW1lKTtcblx0XHRjb25kID0gY29uZCBhbmQgZGF0YS5oYXMoXCJwYXNzd29yZFwiKTtcblx0XHRjb25kID0gY29uZCBhbmQgcGFzc1BhdHRlcm4udGVzdChkYXRhLnBhc3N3b3JkKTtcblx0XHRsZXQgdGV4dCA9IGlmIChjb25kLCB7XG5cdFx0XHRyZXR1cm4gXG5cdFx0XHQ8c3BhbiBzdHlsZT1bXG5cdFx0XHRcdGNvbG9yOiBcImdyZWVuXCIsXG5cdFx0XHRcdGZvbnQtd2VpZ2h0OiBcImJvbGRcIl0+XG5cdFx0XHRcdFwiUmVnaXN0cmF0aW9uIHBhc3NlcyBjcml0ZXJpYS5cIjtcblx0XHRcdDwvc3Bhbj47XG5cdFx0fSwge1xuXHRcdFx0cmV0dXJuIFxuXHRcdFx0PHNwYW4gc3R5bGU9W1xuXHRcdFx0XHRjb2xvcjogXCJyZWRcIiwgXG5cdFx0XHRcdGZvbnQtd2VpZ2h0OiBcImJvbGRcIl0+XG5cdFx0XHRcdFwiUmVnaXN0cmF0aW9uIGRvZXNuJ3QgcGFzcyBjcml0ZXJpYS4gVXNlcm5hbWUgYW5kIFBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgMyBjaGFyYWN0ZXJzIGxvbmcuXCI7XG5cdFx0XHQ8L3NwYW4+O1xuXHRcdH0pO1xuXHRcdGNsaWVudC5lbWl0KFwicmVnaXN0ZXJcIiwgdGV4dCk7XG5cdH0pO1xufSk7XG5cbnNlcnZlci5nZXQoXCIvXCIsIChjbGllbnQ6IFtdKSB7XG5cdGNsaWVudC5yZXNwb25zZS5yZW5kZXIocGFnZSk7XG59KTtcblxuc2VydmVyLmxpc3RlbihbcG9ydDogODAwMCwgY2xpZW50U2NvcGU6IHRydWVdKTsiXX0=