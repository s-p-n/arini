"use strict";require("core-js/modules/es7.promise.finally"),require("core-js/modules/es6.promise"),require("core-js/modules/es6.regexp.replace"),require("core-js/modules/es6.regexp.match"),require("core-js/modules/es7.symbol.async-iterator"),require("core-js/modules/es6.symbol"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/web.dom.iterable"),require("core-js/modules/es6.map");function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}var fs=require("fs"),path=require("path"),ScopeParser=require("./ScopeParser.js");module.exports=function(scope){var userTags=scope.userTags,ScopeApi={print:function e(a){for(var b,c=[],d=0;d<a.length;d+=1)a[d]instanceof Map||a[d]instanceof scope.arrayExpression().__proto__.constructor?c.push(a[d].toString()):c.push(a[d]);(b=console).log.apply(b,c)},createTag:function c(a,b){userTags[a.toLowerCase()]=b},getTag:function b(a){return userTags[a.toLowerCase()]},getAllTags:function a(){return userTags},debug:function b(a){a.forEach(function(a){ScopeApi.print([ScopeApi.__debugReturn(a)])})},__debugReturn:function __debugReturn(value){var spaces=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2,result="",spacef=function(){for(var a="",b=0;b<spaces;b+=1)a+=" ";return a};if("object"==typeof value&&value instanceof Map){result+="Map(";var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=value[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],val=_step$value[1];result+="\n".concat(spacef()).concat(key," => ").concat(ScopeApi.__debugReturn(val,spaces+2))}}catch(a){_didIteratorError=!0,_iteratorError=a}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return"".concat(result,")")}if("function"==typeof value){var source=value.toString(),args=source.match(/^\(args\=(\[.*\])\)/);return args=args[1]?eval(args[1]):[],result+="Scope([",args.forEach(function(a){result+="\n".concat(spacef(),"(").concat(typeof a.value,") ").concat(a.key,": ").concat(ScopeApi.__debugReturn(a.value,spaces+2))}),"".concat(result,"])")}return"string"==typeof value?"\"".concat(value,"\""):value},dereference:function d(a,b){var c;return void 0===b?b=a:c=a,c instanceof Map||c instanceof scope.arrayExpression().__proto__.constructor?c.delete(b):scope.dereferenceIdentifier(b)},if:function j(a){var b=_slicedToArray(a,4),c=b[0],d=b[1],e=void 0===d?function(){}:d,f=b[2],g=void 0===f?function(){}:f,h=b[3],i=void 0===h||h;return c?i&&"function"==typeof e?e():e:i&&"function"==typeof g?g():g},each:function t(a){var b=_slicedToArray(a,2),c=b[0],d=b[1],e=void 0===d?function(){}:d,f=!1,g=function(){f=!0};if("numeric"===c.type){for(var h=[],j=0;j<c.size&&(h.push(e(c.get(j),j,g)),!f);j+=1);return scope.arrayExpression.apply(scope,h)}var k=scope.mapExpression(),l=!0,m=!1,n=void 0;try{for(var o,p=c[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=_slicedToArray(o.value,2),r=q[0],s=q[1];if(k.set(r,e(s,r,g)),f)break}}catch(a){m=!0,n=a}finally{try{l||null==p.return||p.return()}finally{if(m)throw n}}return k},toJS:function n(a){var b;if("object"!=typeof a||null===a)return a;if(a instanceof Map){b={};var c=!0,d=!1,e=void 0;try{for(var f,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=_slicedToArray(f.value,2),j=h[0],k=h[1];b[j]=ScopeApi.toJS(k)}}catch(a){d=!0,e=a}finally{try{c||null==g.return||g.return()}finally{if(d)throw e}}return b}if(a instanceof scope.arrayExpression().__proto__.constructor){for(var l=[],m=0;m<a.size;m+=1)l.push(ScopeApi.toJS(a[m]));return l}return null},toJSON:function b(a){return JSON.stringify(ScopeApi.toJS(a))},BSONtoMap:function c(a){var b;if("object"!=typeof a||Buffer.isBuffer(a)||"_bsontype"in a)return a;if(null===a)return!1;if(a instanceof Array){b=scope.arrayExpression();for(var d=0;d<a.length;d+=1)b[d]=ScopeApi.BSONtoMap(a[d]);return b}for(var e in b=scope.mapExpression(),a)Object.hasOwnProperty.call(a,e)&&(b[e]=ScopeApi.BSONtoMap(a[e]));return b},eval:function _eval(code){var parser=new ScopeParser,translation=parser.translate(code);return eval(translation.code)},compile:function e(a){var b=new ScopeParser,c=path.join(__scopedir,a),d=c.replace(/\.sc$/,".js");return new ScopeApi.promise(function(a,e){fs.readFile(c,"utf8",function(f,g){f&&e("Could not read file ".concat(c,".\n").concat(f));var h=b.translate(g,c,d);fs.writeFile(d,h.code,function(b){b&&e("Could not write to file ".concat(d,".\n").concat(b));var c=scope.import(d);a(c)})})})},promise:function d(a){var b=new Promise(function(b,c){a(b,c)}),c=scope.mapExpression();return c.set("then",function(a){b.then(function(b){a(b)})}),c.set("catch",function(a){b.catch(function(b){a(b)})}),c.set("finally",function(a){b.finally(function(){a()})}),c.originalPromise=b,c}};return ScopeApi.promise.get=function(a){return ScopeApi.promise[a]},ScopeApi.promise.all=function(a){var b=[],c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=_slicedToArray(g.value,2),j=i[0],k=i[1],l=void 0;l=void 0===k.originalPromise?k:k.originalPromise,b.push(l),c.push(j)}}catch(a){e=!0,f=a}finally{try{d||null==h.return||h.return()}finally{if(e)throw f}}var m=Promise.all(b),n=scope.mapExpression();return n.set("then",function(a){m.then(function(b){for(var d=scope.mapExpression(),e=0;e<b.length;e+=1)d.set(c[e],b[e]);a(d)})}),n.set("catch",function(a){m.catch(function(b){a(b)})}),n.set("finally",function(a){m.finally(function(){a()})}),n},ScopeApi.print=scope.createScope(ScopeApi.print),ScopeApi.debug=scope.createScope(ScopeApi.debug),ScopeApi.if=scope.createScope(ScopeApi.if),ScopeApi.each=scope.createScope(ScopeApi.each),ScopeApi};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zY29wZVJ1bnRpbWVBcGkuanMiXSwibmFtZXMiOlsiZnMiLCJyZXF1aXJlIiwicGF0aCIsIlNjb3BlUGFyc2VyIiwibW9kdWxlIiwiZXhwb3J0cyIsInNjb3BlIiwidXNlclRhZ3MiLCJTY29wZUFwaSIsInZhbHVlIiwicmVzdWx0IiwiaSIsImxlbmd0aCIsIk1hcCIsImFycmF5RXhwcmVzc2lvbiIsIl9fcHJvdG9fXyIsImNvbnN0cnVjdG9yIiwicHVzaCIsInRvU3RyaW5nIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZVRhZyIsIm5hbWUiLCJUIiwidG9Mb3dlckNhc2UiLCJnZXRUYWciLCJnZXRBbGxUYWdzIiwiZm9yRWFjaCIsInZhbCIsInByaW50IiwiX19kZWJ1Z1JldHVybiIsInNwYWNlcyIsInNwYWNlZiIsInIiLCJrZXkiLCJzb3VyY2UiLCJhcmdzIiwibWF0Y2giLCJldmFsIiwiYXJnIiwiaWRPck1hcCIsImlkIiwibWFwIiwiZGVsZXRlIiwiZGVyZWZlcmVuY2VJZGVudGlmaWVyIiwiY29uZGl0aW9uIiwiaWZUcnVlRXhwciIsImlmRmFsc2VFeHByIiwiZXhlY3V0ZVNjb3BlcyIsImFycmF5IiwiYmxvY2siLCJjYW5jZWxMb29wIiwiY2FuY2VsIiwidHlwZSIsInNpemUiLCJnZXQiLCJtYXBFeHByZXNzaW9uIiwic2V0IiwidG9KUyIsImlucHV0IiwidG9KU09OIiwiSlNPTiIsInN0cmluZ2lmeSIsIkJ1ZmZlciIsImlzQnVmZmVyIiwiQXJyYXkiLCJCU09OdG9NYXAiLCJPYmplY3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJjb2RlIiwicGFyc2VyIiwidHJhbnNsYXRpb24iLCJ0cmFuc2xhdGUiLCJmaWxlbmFtZSIsInNyY0ZpbGVuYW1lIiwiam9pbiIsIl9fc2NvcGVkaXIiLCJsaWJGaWxlbmFtZSIsInJlcGxhY2UiLCJwcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlYWRGaWxlIiwiZXJyIiwic3JjQ29kZSIsIndyaXRlRmlsZSIsImltcCIsImltcG9ydCIsImV4ZWN1dG9yIiwicCIsIlByb21pc2UiLCJzUCIsInNjIiwidGhlbiIsImNhdGNoIiwiZmluYWxseSIsIm9yaWdpbmFsUHJvbWlzZSIsImFsbCIsIm0iLCJhcnJWIiwiYXJySyIsInVucGFja1ZhbCIsInZhbHVlcyIsImNyZWF0ZVNjb3BlIiwiZGVidWciLCJpZiIsImVhY2giXSwibWFwcGluZ3MiOiI0NkJBQUlBLENBQUFBLEVBQUUsQ0FBR0MsT0FBTyxDQUFDLElBQUQsQyxDQUNaQyxJQUFJLENBQUdELE9BQU8sQ0FBQyxNQUFELEMsQ0FDZEUsV0FBVyxDQUFHRixPQUFPLENBQUUsa0JBQUYsQyxDQUV6QkcsTUFBTSxDQUFDQyxPQUFQLENBQWlCLFNBQUNDLEtBQUQsQ0FBVyxJQUN0QkMsQ0FBQUEsUUFBUSxDQUFHRCxLQUFLLENBQUNDLFFBREssQ0FFcEJDLFFBQVEsQ0FBRyxDQUNmLE1BQVMsV0FBQUMsQ0FBSyxDQUFJLENBRWhCLFVBRElDLENBQU0sQ0FBRyxFQUNiLENBQVNDLENBQUMsQ0FBRyxDQUFiLENBQWdCQSxDQUFDLENBQUdGLENBQUssQ0FBQ0csTUFBMUIsQ0FBa0NELENBQUMsRUFBSSxDQUF2QyxDQUNNRixDQUFLLENBQUNFLENBQUQsQ0FBTCxVQUFvQkUsQ0FBQUEsR0FBcEIsRUFBMkJKLENBQUssQ0FBQ0UsQ0FBRCxDQUFMLFVBQW9CTCxDQUFBQSxLQUFLLENBQUNRLGVBQU4sR0FBd0JDLFNBQXhCLENBQWtDQyxXQUR2RixDQUVJTixDQUFNLENBQUNPLElBQVAsQ0FBWVIsQ0FBSyxDQUFDRSxDQUFELENBQUwsQ0FBU08sUUFBVCxFQUFaLENBRkosQ0FJSVIsQ0FBTSxDQUFDTyxJQUFQLENBQVlSLENBQUssQ0FBQ0UsQ0FBRCxDQUFqQixDQUpKLENBT0EsR0FBQVEsT0FBTyxFQUFDQyxHQUFSLFNBQWVWLENBQWYsQ0FDRCxDQVhjLENBWWZXLFNBQVMsQ0FBRSxXQUFDQyxDQUFELENBQU9DLENBQVAsQ0FBYSxDQUN0QmhCLFFBQVEsQ0FB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QVEsQ0FDeEJILENBQUMsQ0FBQ00sT0FBRixDQUFVLFVBQU0sQ0FDZEgsQ0FBRSxFQUNILENBRkQsQ0FHRCxDQUpELENBTUEsQ0FBT0QsQ0FDUixDQUtELENBSkFwRixRQUFRLENBQUNxQixLQUFULENBQWlCdkIsS0FBSyxDQUFDa0csV0FBTixDQUFrQmhHLFFBQVEsQ0FBQ3FCLEtBQTNCLENBSWpCLENBSEFyQixRQUFRLENBQUNpRyxLQUFULENBQWlCbkcsS0FBSyxDQUFDa0csV0FBTixDQUFrQmhHLFFBQVEsQ0FBQ2lHLEtBQTNCLENBR2pCLENBRkFqRyxRQUFRLENBQUNrRyxFQUFULENBQWNwRyxLQUFLLENBQUNrRyxXQUFOLENBQWtCaEcsUUFBUSxDQUFDa0csRUFBM0IsQ0FFZCxDQURBbEcsUUFBUSxDQUFDbUcsSUFBVCxDQUFnQnJHLEtBQUssQ0FBQ2tHLFdBQU4sQ0FBa0JoRyxRQUFRLENBQUNtRyxJQUEzQixDQUNoQixDQUFPbkcsUUFDUixDIiwic291cmNlc0NvbnRlbnQiOlsibGV0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmxldCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xubGV0IFNjb3BlUGFyc2VyID0gcmVxdWlyZSAoJy4vU2NvcGVQYXJzZXIuanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSAoc2NvcGUpID0+IHtcbiAgbGV0IHVzZXJUYWdzID0gc2NvcGUudXNlclRhZ3M7XG4gIGNvbnN0IFNjb3BlQXBpID0ge1xuICAgIFwicHJpbnRcIjogdmFsdWUgPT4ge1xuICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAodmFsdWVbaV0gaW5zdGFuY2VvZiBNYXAgfHwgdmFsdWVbaV0gaW5zdGFuY2VvZiBzY29wZS5hcnJheUV4cHJlc3Npb24oKS5fX3Byb3RvX18uY29uc3RydWN0b3IpIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZVtpXS50b1N0cmluZygpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZVtpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKC4uLnJlc3VsdCk7XG4gICAgfSxcbiAgICBjcmVhdGVUYWc6IChuYW1lLCBUKSA9PiB7XG4gICAgICB1c2VyVGFnc1tuYW1lLnRvTG93ZXJDYXNlKCldID0gVDtcbiAgICB9LFxuICAgIGdldFRhZzogbmFtZSA9PiB7XG4gICAgICByZXR1cm4gdXNlclRhZ3NbbmFtZS50b0xvd2VyQ2FzZSgpXTtcbiAgICB9LFxuICAgIGdldEFsbFRhZ3M6ICgpID0+IHtcbiAgICAgIHJldHVybiB1c2VyVGFncztcbiAgICB9LFxuICAgIFwiZGVidWdcIjogdmFsdWUgPT4ge1xuICAgIHZhbHVlLmZvckVhY2goKHZhbCkgPT4ge1xuICAgICAgU2NvcGVBcGkucHJpbnQoW1Njb3BlQXBpLl9fZGVidWdSZXR1cm4odmFsKV0pO1xuICAgIH0pO1xuICAgIH0sXG5cbiAgICBcIl9fZGVidWdSZXR1cm5cIjogKHZhbHVlLCBzcGFjZXM9MikgPT4ge1xuICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgIGxldCBzcGFjZWYgPSAoKSA9PiB7XG4gICAgICBsZXQgciA9ICcnO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzcGFjZXM7IGkgKz0gMSkge1xuICAgICAgciArPSAnICc7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9O1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgaW5zdGFuY2VvZiBNYXApIHtcbiAgICAgIHJlc3VsdCArPSBcIk1hcChcIjtcbiAgICAgIGZvciAobGV0IFtrZXksIHZhbF0gb2YgdmFsdWUpIHtcbiAgICAgIHJlc3VsdCArPSBgXFxuJHtzcGFjZWYoKX0ke2tleX0gPT4gJHtTY29wZUFwaS5fX2RlYnVnUmV0dXJuKHZhbCwgc3BhY2VzICsgMil9YFxuICAgICAgfVxuICAgICAgcmV0dXJuIGAke3Jlc3VsdH0pYDtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBsZXQgc291cmNlID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgIGxldCBhcmdzID0gc291cmNlLm1hdGNoKC9eXFwoYXJnc1xcPShcXFsuKlxcXSlcXCkvKTtcbiAgICAgIGlmIChhcmdzWzFdKSB7XG4gICAgICBhcmdzID0gZXZhbChhcmdzWzFdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICBhcmdzID0gW107XG4gICAgICB9XG4gICAgICByZXN1bHQgKz0gXCJTY29wZShbXCI7XG4gICAgICBhcmdzLmZvckVhY2goKGFyZykgPT4ge1xuICAgICAgcmVzdWx0ICs9IGBcXG4ke3NwYWNlZigpfSgke3R5cGVvZiBhcmcudmFsdWV9KSAke2FyZy5rZXl9OiAke1Njb3BlQXBpLl9fZGVidWdSZXR1cm4oYXJnLnZhbHVlLCBzcGFjZXMgKyAyKX1gO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYCR7cmVzdWx0fV0pYDtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuIGBcIiR7dmFsdWV9XCJgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIH0sXG5cbiAgICBcImRlcmVmZXJlbmNlXCI6IChpZE9yTWFwLCBpZCkgPT4ge1xuICAgICAgbGV0IG1hcDtcbiAgICAgIGlmIChpZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlkID0gaWRPck1hcDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hcCA9IGlkT3JNYXA7XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXAgaW5zdGFuY2VvZiBNYXAgfHwgbWFwIGluc3RhbmNlb2Ygc2NvcGUuYXJyYXlFeHByZXNzaW9uKCkuX19wcm90b19fLmNvbnN0cnVjdG9yKSB7XG4gICAgICAgIHJldHVybiBtYXAuZGVsZXRlKGlkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzY29wZS5kZXJlZmVyZW5jZUlkZW50aWZpZXIoaWQpO1xuICAgIH0sXG5cbiAgICBcImlmXCI6IChbY29uZGl0aW9uLCBpZlRydWVFeHByID0gKCkgPT4ge30sIGlmRmFsc2VFeHByID0gKCkgPT4ge30sIGV4ZWN1dGVTY29wZXMgPSB0cnVlXSkgPT4ge1xuICAgICAgaWYgKGNvbmRpdGlvbikge1xuICAgICAgICBpZiAoZXhlY3V0ZVNjb3BlcyAmJiB0eXBlb2YgaWZUcnVlRXhwciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgcmV0dXJuIGlmVHJ1ZUV4cHIoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaWZUcnVlRXhwcjtcbiAgICAgIH1cbiAgICAgIGlmIChleGVjdXRlU2NvcGVzICYmIHR5cGVvZiBpZkZhbHNlRXhwciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBpZkZhbHNlRXhwcigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGlmRmFsc2VFeHByO1xuICAgIH0sXG5cbiAgICBcImVhY2hcIjogKFthcnJheSwgYmxvY2sgPSAoKSA9PiB7fV0pID0+IHtcbiAgICAgIGxldCBjYW5jZWxMb29wID0gZmFsc2U7XG4gICAgICBsZXQgY2FuY2VsID0gKCkgPT4ge1xuICAgICAgICBjYW5jZWxMb29wID0gdHJ1ZTtcbiAgICAgIH07XG4gICAgICBpZiAoYXJyYXkudHlwZSA9PT0gXCJudW1lcmljXCIpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5LnNpemU7IGkgKz0gMSkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKGJsb2NrKGFycmF5LmdldChpKSwgaSwgY2FuY2VsKSk7XG4gICAgICAgICAgaWYgKGNhbmNlbExvb3ApIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2NvcGUuYXJyYXlFeHByZXNzaW9uKC4uLnJlc3VsdCk7XG4gICAgICB9XG4gICAgICBsZXQgcmVzdWx0ID0gc2NvcGUubWFwRXhwcmVzc2lvbigpO1xuICAgICAgZm9yIChsZXQgW2tleSwgdmFsXSBvZiBhcnJheSkge1xuICAgICAgICByZXN1bHQuc2V0KGtleSwgYmxvY2sodmFsLCBrZXksIGNhbmNlbCkpO1xuICAgICAgICBpZiAoY2FuY2VsTG9vcCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgdG9KUzogKGlucHV0KSA9PiB7XG4gICAgICBsZXQgcmVzdWx0O1xuICAgICAgaWYgKHR5cGVvZiBpbnB1dCAhPT0gXCJvYmplY3RcIiB8fCBpbnB1dCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICB9XG4gICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBNYXApIHtcbiAgICAgICAgcmVzdWx0ID0ge307XG4gICAgICAgIGZvciAobGV0IFtrZXksIHZhbF0gb2YgaW5wdXQpIHtcbiAgICAgICAgICByZXN1bHRba2V5XSA9IFNjb3BlQXBpLnRvSlModmFsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2Ygc2NvcGUuYXJyYXlFeHByZXNzaW9uKCkuX19wcm90b19fLmNvbnN0cnVjdG9yKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5zaXplOyBpICs9IDEpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChTY29wZUFwaS50b0pTKGlucHV0W2ldKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG4gICAgdG9KU09OOiAoaW5wdXQpID0+IHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShTY29wZUFwaS50b0pTKGlucHV0KSk7XG4gICAgfSxcbiAgICBcIkJTT050b01hcFwiOiAoaW5wdXQpID0+IHtcbiAgICAgIGxldCByZXN1bHQ7XG4gICAgICBpZiAodHlwZW9mIGlucHV0ICE9PSBcIm9iamVjdFwiIHx8IEJ1ZmZlci5pc0J1ZmZlcihpbnB1dCkgfHwgKFwiX2Jzb250eXBlXCIgaW4gaW5wdXQpKSB7XG4gICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgIH1cbiAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICByZXN1bHQgPSBzY29wZS5hcnJheUV4cHJlc3Npb24oKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgIHJlc3VsdFtpXSA9IFNjb3BlQXBpLkJTT050b01hcChpbnB1dFtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIHJlc3VsdCA9IHNjb3BlLm1hcEV4cHJlc3Npb24oKTtcbiAgICAgIGZvciAobGV0IGkgaW4gaW5wdXQpIHtcbiAgICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGlucHV0LCBpKSkge1xuICAgICAgICAgIHJlc3VsdFtpXSA9IFNjb3BlQXBpLkJTT050b01hcChpbnB1dFtpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbiAgICBcImV2YWxcIjogKGNvZGUpID0+IHtcbiAgICAgIGxldCBwYXJzZXIgPSBuZXcgU2NvcGVQYXJzZXIoKTtcbiAgICAgIGxldCB0cmFuc2xhdGlvbiA9IHBhcnNlci50cmFuc2xhdGUoY29kZSk7XG4gICAgICByZXR1cm4gZXZhbCh0cmFuc2xhdGlvbi5jb2RlKTtcbiAgICB9LFxuICAgIFwiY29tcGlsZVwiOiAoZmlsZW5hbWUpID0+IHtcbiAgICAgIGxldCBwYXJzZXIgPSBuZXcgU2NvcGVQYXJzZXIoKTtcbiAgICAgIGxldCBzcmNGaWxlbmFtZSA9IHBhdGguam9pbihfX3Njb3BlZGlyLCBmaWxlbmFtZSk7XG4gICAgICBsZXQgbGliRmlsZW5hbWUgPSBzcmNGaWxlbmFtZS5yZXBsYWNlKC9cXC5zYyQvLCBcIi5qc1wiKTtcbiAgICAgIHJldHVybiBuZXcgU2NvcGVBcGkucHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGZzLnJlYWRGaWxlKHNyY0ZpbGVuYW1lLCBcInV0ZjhcIiwgKGVyciwgc3JjQ29kZSkgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChgQ291bGQgbm90IHJlYWQgZmlsZSAke3NyY0ZpbGVuYW1lfS5cXG4ke2Vycn1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IHRyYW5zbGF0aW9uID0gcGFyc2VyLnRyYW5zbGF0ZShzcmNDb2RlLCBzcmNGaWxlbmFtZSwgbGliRmlsZW5hbWUpO1xuICAgICAgICAgIGZzLndyaXRlRmlsZShsaWJGaWxlbmFtZSwgdHJhbnNsYXRpb24uY29kZSwgKGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICByZWplY3QoYENvdWxkIG5vdCB3cml0ZSB0byBmaWxlICR7bGliRmlsZW5hbWV9LlxcbiR7ZXJyfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGltcCA9IHNjb3BlLmltcG9ydChsaWJGaWxlbmFtZSk7XG4gICAgICAgICAgICByZXNvbHZlKGltcCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcInByb21pc2VcIjogZnVuY3Rpb24gKGV4ZWN1dG9yKSB7XG4gICAgICBsZXQgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZXhlY3V0b3IocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgIH0pO1xuICAgICAgbGV0IHNQID0gc2NvcGUubWFwRXhwcmVzc2lvbigpO1xuXG4gICAgICBzUC5zZXQoXCJ0aGVuXCIsIChzYykgPT4ge1xuICAgICAgICBwLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgIHNjKHJlc3VsdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHNQLnNldChcImNhdGNoXCIsIChzYykgPT4ge1xuICAgICAgICBwLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBzYyhlcnIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBzUC5zZXQoXCJmaW5hbGx5XCIsIChzYykgPT4ge1xuICAgICAgICBwLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgIHNjKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHNQLm9yaWdpbmFsUHJvbWlzZSA9IHA7XG5cbiAgICAgIHJldHVybiBzUDtcbiAgICB9XG4gIH07XG4gIFNjb3BlQXBpLnByb21pc2UuZ2V0ID0gKGtleSkgPT4ge1xuICAgIHJldHVybiBTY29wZUFwaS5wcm9taXNlW2tleV07XG4gIH07XG4gIFNjb3BlQXBpLnByb21pc2UuYWxsID0gKG0pID0+IHtcbiAgICBsZXQgYXJyViA9IFtdO1xuICAgIGxldCBhcnJLID0gW107XG4gICAgZm9yIChsZXQgW2tleSwgdmFsXSBvZiBtKSB7XG4gICAgICBsZXQgdW5wYWNrVmFsO1xuICAgICAgaWYgKHZhbC5vcmlnaW5hbFByb21pc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1bnBhY2tWYWwgPSB2YWwub3JpZ2luYWxQcm9taXNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdW5wYWNrVmFsID0gdmFsO1xuICAgICAgfVxuICAgICAgYXJyVi5wdXNoKHVucGFja1ZhbCk7XG4gICAgICBhcnJLLnB1c2goa2V5KTtcbiAgICB9XG5cbiAgICBsZXQgcCA9IFByb21pc2UuYWxsKGFyclYpO1xuICAgIGxldCBzUCA9IHNjb3BlLm1hcEV4cHJlc3Npb24oKTtcblxuICAgIHNQLnNldChcInRoZW5cIiwgKHNjKSA9PiB7XG4gICAgICBwLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgICBsZXQgcmVzdWx0ID0gc2NvcGUubWFwRXhwcmVzc2lvbigpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgIHJlc3VsdC5zZXQoYXJyS1tpXSwgdmFsdWVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBzYyhyZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBzUC5zZXQoXCJjYXRjaFwiLCAoc2MpID0+IHtcbiAgICAgIHAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBzYyhlcnIpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBzUC5zZXQoXCJmaW5hbGx5XCIsIChzYykgPT4ge1xuICAgICAgcC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgc2MoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNQO1xuICB9O1xuICBTY29wZUFwaS5wcmludCA9IHNjb3BlLmNyZWF0ZVNjb3BlKFNjb3BlQXBpLnByaW50KTtcbiAgU2NvcGVBcGkuZGVidWcgPSBzY29wZS5jcmVhdGVTY29wZShTY29wZUFwaS5kZWJ1Zyk7XG4gIFNjb3BlQXBpLmlmID0gc2NvcGUuY3JlYXRlU2NvcGUoU2NvcGVBcGkuaWYpO1xuICBTY29wZUFwaS5lYWNoID0gc2NvcGUuY3JlYXRlU2NvcGUoU2NvcGVBcGkuZWFjaCk7XG4gIHJldHVybiBTY29wZUFwaTtcbn07Il19