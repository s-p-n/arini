"use strict";require("core-js/modules/es6.array.from"),require("core-js/modules/es7.symbol.async-iterator"),require("core-js/modules/es6.symbol"),require("core-js/modules/es6.regexp.to-string"),require("core-js/modules/es6.regexp.replace"),require("core-js/modules/web.dom.iterable");var fs=_interopRequireWildcard(require("fs")),path=_interopRequireWildcard(require("path")),Module=_interopRequireWildcard(require("module")),parser=_interopRequireWildcard(require("./parser.js")),_ScopeAst=_interopRequireDefault(require("./ScopeAst.js")),_ScopeRules=_interopRequireDefault(require("./ScopeRules.js")),_BacktickProcessor=_interopRequireDefault(require("./BacktickProcessor.js")),sourceMap=_interopRequireWildcard(require("source-map")),combine=_interopRequireWildcard(require("combine-source-map")),convert=_interopRequireWildcard(require("convert-source-map"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}return b.default=a,b}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}require("source-map-support").install();var ScopeParser=function(){function a(){_classCallCheck(this,a);var b=this;b.parser=new parser.Parser,b.rules=new _ScopeRules.default,b.parser.yy.scopeAst=_ScopeAst.default}return _createClass(a,[{key:"libraryUtils",value:function a(){return{runtime:require("./scopeRuntime.js"),api:require("./scopeRuntimeApi.js")}}},{key:"parse",value:function e(a){var b=this,c=b.parser.lexer.lex;b.parser.yy.scopeState={};var d=new _BacktickProcessor.default(b);return b.parser.lexer.lex=function(){var a;return a=d.lex(this),!1===a?c.call(this):a},this.parser.parse(a)}},{key:"traverse",value:function d(a){var b=this;if(null===a)return null;if("object"!=typeof a)return a;if(void 0===a.type)return a;if(void 0!==a.loc){var e=b.rules.state.loc.name;b.rules.state.loc=a.loc,b.rules.state.loc.name=e}if(a.body instanceof Array){var f=b.rules.parentNode;a.traversedBody=[],a.body.forEach(function(c){b.rules.parentNode=a.type,a.traversedBody.push(b.traverse(c))}),b.rules.parentNode=f}if(b.rules[a.type]){if(b.rules.state.setName(a.type),a.body instanceof Array){var c;return(c=b.rules)[a.type].apply(c,_toConsumableArray(a.traversedBody))}return b.rules.state.loc.sourceCode=a.body,b.rules[a.type](a.body)}return console.log("".concat(a.type," not implemented")),"Not implemented"}},{key:"import",value:function q(b,c,d,e){var f=this;d=JSON.parse(d);var g=path.resolve(path.dirname(b),d);if(!fs.existsSync(g)){var h=path.resolve(__dirname,"../packages"),i=fs.readdirSync(h);if(-1!==i.indexOf(d)){var j=path.join(h,d),k=require(path.join(j,"spn.json")),l=path.join(j,k.main);g=path.resolve(path.dirname(b),l)}else throw new Error("File \"".concat(d,"\" doesn't exist ").concat(f.rules.state.errorTail()))}if(/\.sc$/.test(g)){var m=path.resolve(path.dirname(c),d.replace(/\.sc$/,".js")),n=fs.readFileSync(g,"utf8"),o=new a().translate(n,g,m),p=path.dirname(m);fs.existsSync(p)||fs.mkdirSync(p),fs.writeFileSync(m,o.code);var r={source:o.code,sourceFile:m};return f.imported.push({file:r,offset:{line:e}}),"scope.import(".concat(JSON.stringify(m),")")}return"scope.import(".concat(JSON.stringify(g),")")}},{key:"translate",value:function s(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"NO SOURCE FILE",c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"NO LIB FILE",d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],e=this,f="";f+="undefined"==typeof window?"#!/usr/bin/env node\n\"use strict\";global.__scopedir=__dirname;require(\"source-map-support\").install();const scope=require(\""+path.join(__dirname,"scopeRuntime.js")+"\");const ScopeApi=require(\""+path.join(__dirname,"scopeRuntimeApi.js")+"\")(scope);":"\"use strict\";";var g,h;e.mapAndParse=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{source:"",translation:"",sn:""};return"string"!=typeof a.sn&&a.sn.setSourceContent(b,a.source),a},e.sn=function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:e.rules.state.getName(),d=e.rules.state.loc.start;return new sourceMap.SourceNode(d.line,d.column,b,a,c)};var i,j=e.sn("");e.imported=[],e.rules=new _ScopeRules.default,e.rules.parser=e,e.rules.srcFilename=b,e.rules.libFilename=c,e.rules.node=j,e.rules.sn=e.sn,e.rules.mapAndParse=e.mapAndParse;var k=this.parse(a),l=JSON.stringify(k,null,"  "),m=e.traverse(k);if(d)return e.rules.invokeExpression(e.rules.scopeExpression(m),e.rules.invokeArguments()).sn;h=e.rules.invokeExpression(e.rules.scopeExpression(e.rules.scopeStart(),m),e.rules.invokeArguments()).sn,h.prepend([f,"module.exports="]),h.add([";"]),i=h.toStringWithSourceMap(),i.map=JSON.parse(i.map.toString()),i.map.sourcesContent=[a],i.comment=convert.fromObject(i.map).toComment();var n={source:i.code+"\n".concat(i.comment),sourceFile:c},p=combine.create(c.replace(/\.js$/,".min.js")).addFile(n,{line:1});e.imported.forEach(function(a){p.addFile(a.file,a.offset)});var q=p.base64(),r=convert.fromBase64(q).toObject();return g={ast:l,map:r,code:i.code+"\n".concat(i.comment)},g}}]),a}();module.exports=ScopeParser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TY29wZVBhcnNlci5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiaW5zdGFsbCIsIlNjb3BlUGFyc2VyIiwic2VsZiIsInBhcnNlciIsIlBhcnNlciIsInJ1bGVzIiwiU2NvcGVSdWxlcyIsInl5Iiwic2NvcGVBc3QiLCJTY29wZUFzdCIsInJ1bnRpbWUiLCJhcGkiLCJjb2RlIiwiamlzb25MZXhlciIsImxleGVyIiwibGV4Iiwic2NvcGVTdGF0ZSIsImJ0UHJvY2Vzc29yIiwiQmFja3RpY2tQcm9jZXNzb3IiLCJjYWxsIiwicGFyc2UiLCJvYmoiLCJ0eXBlIiwibG9jIiwibmFtZSIsInN0YXRlIiwiYm9keSIsIkFycmF5IiwibGFzdFBhcmVudCIsInBhcmVudE5vZGUiLCJ0cmF2ZXJzZWRCb2R5IiwiZm9yRWFjaCIsImkiLCJwdXNoIiwidHJhdmVyc2UiLCJzZXROYW1lIiwic291cmNlQ29kZSIsImNvbnNvbGUiLCJsb2ciLCJzcmNGaWxlbmFtZSIsImxpYkZpbGVuYW1lIiwiZmlsZW5hbWUiLCJsaW5lT2Zmc2V0IiwiSlNPTiIsIm1TcmNGaWxlbmFtZSIsInBhdGgiLCJyZXNvbHZlIiwiZGlybmFtZSIsImZzIiwiZXhpc3RzU3luYyIsInBhY2thZ2VzRGlyIiwiX19kaXJuYW1lIiwicGFja2FnZXMiLCJyZWFkZGlyU3luYyIsImluZGV4T2YiLCJzY29wZVBhY2thZ2VEaXIiLCJqb2luIiwic3BuIiwibWFpbiIsIkVycm9yIiwiZXJyb3JUYWlsIiwidGVzdCIsIm1MaWJGaWxlbmFtZSIsInJlcGxhY2UiLCJtQ29kZSIsInJlYWRGaWxlU3luYyIsIm1SZXN1bHQiLCJ0cmFuc2xhdGUiLCJtTGliRGlybmFtZSIsIm1rZGlyU3luYyIsIndyaXRlRmlsZVN5bmMiLCJmaWxlIiwic291cmNlIiwic291cmNlRmlsZSIsImltcG9ydGVkIiwib2Zmc2V0IiwibGluZSIsInN0cmluZ2lmeSIsImFzSW5jbHVkZSIsInNjb3BlUnVudGltZSIsIndpbmRvdyIsInJlc3VsdCIsInRyYXZlcnNhbCIsIm1hcEFuZFBhcnNlIiwiZGF0YSIsInRyYW5zbGF0aW9uIiwic24iLCJzZXRTb3VyY2VDb250ZW50IiwiY2h1bmsiLCJnZXROYW1lIiwic3RhcnQiLCJzb3VyY2VNYXAiLCJTb3VyY2VOb2RlIiwiY29sdW1uIiwic20iLCJub2RlIiwiYXN0IiwiYXN0SlNPTiIsInBhcnNlUmVzdWx0IiwiaW52b2tlRXhwcmVzc2lvbiIsInNjb3BlRXhwcmVzc2lvbiIsImludm9rZUFyZ3VtZW50cyIsInNjb3BlU3RhcnQiLCJwcmVwZW5kIiwiYWRkIiwidG9TdHJpbmdXaXRoU291cmNlTWFwIiwibWFwIiwidG9TdHJpbmciLCJzb3VyY2VzQ29udGVudCIsImNvbW1lbnQiLCJjb252ZXJ0IiwiZnJvbU9iamVjdCIsInRvQ29tbWVudCIsIm1haW5GaWxlIiwiY29tYmluYXRpb24iLCJjb21iaW5lIiwiY3JlYXRlIiwiYWRkRmlsZSIsIm8iLCJiYXNlNjQiLCJuZXdTbSIsImZyb21CYXNlNjQiLCJ0b09iamVjdCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJxakVBQUFBLE9BQU8sQ0FBQyxvQkFBRCxDQUFQLENBQThCQyxPQUE5QixFLElBWU1DLENBQUFBLFcsWUFDTCxZQUFlLHlCQUNkLEdBQU1DLENBQUFBLENBQUksQ0FBRyxJQUFiLENBQ0FBLENBQUksQ0FBQ0MsTUFBTCxDQUFjLEdBQUlBLENBQUFBLE1BQU0sQ0FBQ0MsTUFGWCxDQUdkRixDQUFJLENBQUNHLEtBQUwsQ0FBYSxHQUFJQyxvQkFISCxDQTZHZEosQ0FBSSxDQUFDQyxNQUFMLENBQVlJLEVBQVosQ0FBZUMsUUFBZixDQUEwQkMsaUJBQzFCLEMsNkRBRWUsQ0FDZixNQUFPLENBQ05DLE9BQU8sQ0FBRVgsT0FBTyxDQUFDLG1CQUFELENBRFYsQ0FFTlksR0FBRyxDQUFFWixPQUFPLENBQUMsc0JBQUQsQ0FGTixDQUlQLEMsZ0NBRU1hLEMsQ0FBTSxJQUNOVixDQUFBQSxDQUFJLENBQUcsSUFERCxDQUVS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LENBMEYxRjFFLENBQUksQ0FBQ3dFLFFBQUwsQ0FBYzNDLE9BQWQsQ0FBc0IsU0FBQXVGLENBQUMsQ0FBSSxDQUMxQkosQ0FBVyxDQUFDRyxPQUFaLENBQW9CQyxDQUFDLENBQUMvQyxJQUF0QixDQUE0QitDLENBQUMsQ0FBQzNDLE1BQTlCLENBQ0EsQ0FGRCxDQTFGMEYsSUE2RnRGNEMsQ0FBQUEsQ0FBTSxDQUFHTCxDQUFXLENBQUNLLE1BQVosRUE3RjZFLENBOEZ0RkMsQ0FBSyxDQUFHVixPQUFPLENBQUNXLFVBQVIsQ0FBbUJGLENBQW5CLEVBQTJCRyxRQUEzQixFQTlGOEUsQ0FvRzFGLE1BTEF6QyxDQUFBQSxDQUFNLENBQUcsQ0FDUmUsR0FBRyxDQUFFQyxDQURHLENBRVJTLEdBQUcsQ0FBRWMsQ0FGRyxDQUdSNUcsSUFBSSxDQUFFa0YsQ0FBRSxDQUFDbEYsSUFBSCxhQUFla0YsQ0FBRSxDQUFDZSxPQUFsQixDQUhFLENBS1QsQ0FBTzVCLENBQ1AsQyxTQUdGMEMsTUFBTSxDQUFDQyxPQUFQLENBQWlCM0gsVyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoXCJzb3VyY2UtbWFwLXN1cHBvcnRcIikuaW5zdGFsbCgpO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBNb2R1bGUgZnJvbSBcIm1vZHVsZVwiO1xuaW1wb3J0ICogYXMgcGFyc2VyIGZyb20gXCIuL3BhcnNlci5qc1wiO1xuaW1wb3J0IFNjb3BlQXN0IGZyb20gXCIuL1Njb3BlQXN0LmpzXCI7XG5pbXBvcnQgU2NvcGVSdWxlcyBmcm9tIFwiLi9TY29wZVJ1bGVzLmpzXCI7XG5pbXBvcnQgQmFja3RpY2tQcm9jZXNzb3IgZnJvbSBcIi4vQmFja3RpY2tQcm9jZXNzb3IuanNcIjtcbmltcG9ydCAqIGFzIHNvdXJjZU1hcCBmcm9tIFwic291cmNlLW1hcFwiO1xuaW1wb3J0ICogYXMgY29tYmluZSBmcm9tIFwiY29tYmluZS1zb3VyY2UtbWFwXCI7XG5pbXBvcnQgKiBhcyBjb252ZXJ0IGZyb20gXCJjb252ZXJ0LXNvdXJjZS1tYXBcIjtcblxuY2xhc3MgU2NvcGVQYXJzZXIge1xuXHRjb25zdHJ1Y3RvciAoKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cdFx0c2VsZi5wYXJzZXIgPSBuZXcgcGFyc2VyLlBhcnNlcigpO1xuXHRcdHNlbGYucnVsZXMgPSBuZXcgU2NvcGVSdWxlcygpO1xuXHRcdC8vY29uc29sZS5sb2coc2VsZi5wYXJzZXIubGV4ZXIubGV4LnRvU3RyaW5nKCkpO1xuXHRcdC8vY29uc29sZS5sb2coc2VsZi5wYXJzZXIubGV4ZXIubmV4dC50b1N0cmluZygpKTtcblx0XHQvKlxuXHRcdGxldCBqaXNvbkxleGVyID0gc2VsZi5wYXJzZXIubGV4ZXIubGV4O1xuXHRcdHNlbGYucGFyc2VyLnl5LnNjb3BlU3RhdGUgPSB7XG5cdFx0XHRpbkJhY2t0aWNrOiBmYWxzZSxcblx0XHRcdGluQmFja3RpY2tFeHByOiBmYWxzZVxuXHRcdH07XG5cdFx0bGV0IG9uY2UgPSBmYWxzZTtcblx0XHRcblx0XHRzZWxmLnBhcnNlci5sZXhlci5sZXggPSBmdW5jdGlvbiAoKSB7XG5cdFx0XHRpZiAoIW9uY2UpIHtcblx0XHRcdFx0b25jZSA9ICFvbmNlO1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKHRoaXMpO1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKHRoaXMucnVsZXMpO1xuXHRcdFx0fVxuXHRcdFx0Ly9jb25zb2xlLmxvZyhcImludGVyY2VwdGVkIGxleFwiKTtcblx0XHRcdC8vY29uc29sZS5sb2coXCJpbiBiYWNrdGljazpcIiwgdGhpcy55eS5zY29wZVN0YXRlLmluQmFja3RpY2spO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhcInl5dGV4dDpcIiwgSlNPTi5zdHJpbmdpZnkodGhpcy55eXRleHQpKTtcblx0XHRcdC8vY29uc29sZS5sb2coXCJpbnB1dDpcIiwgdGhpcy5pbnB1dCgpKTtcblx0XHRcdGlmICh0aGlzLnl5dGV4dCA9PT0gXCJgXCIpIHtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcInN3aXRjaGVkIGJhY2t0aWNrIHN0YXRlXCIpO1xuXHRcdFx0XHR0aGlzLnl5LnNjb3BlU3RhdGUuaW5CYWNrdGljayA9ICF0aGlzLnl5LnNjb3BlU3RhdGUuaW5CYWNrdGlja1xuXHRcdFx0XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMueXkuc2NvcGVTdGF0ZS5pbkJhY2t0aWNrKSB7XG5cdFx0XHRcdC8vY29uc29sZS5sb2cgKFwiYXR0ZW1wdGluZyBza2lwXCIpO1xuXHRcdFx0XHQvL2xldCBuZXh0ID0gdGhpcy5uZXh0KCk7XG5cdFx0XHRcdGxldCBpbnB1dE1hdGNoLCB0ZXN0TWF0Y2g7XG5cdFx0XHRcdGxldCBmaW5hbE1hdGNoID0gXCJcIjtcblx0XHRcdFx0bGV0IGJ0RXhwclJlZ2V4ID0gL14oPzooXFxzKilcXCRcXHsoW15cXH1dKilcXH0oLiopKS9ndXM7XG5cdFx0XHRcdGxldCBidEJvZHlSZWdleCA9IC9eKCg/OlxcXFxgfFteYF0oPyFcXHspKSopKC4qKS9ndXM7XG5cblx0XHRcdFx0dGhpcy5faW5wdXQgPSB0aGlzLnl5dGV4dCArIHRoaXMuX2lucHV0O1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKFwiYnRFeHByUmVnZXg6XCIsIGJ0RXhwclJlZ2V4KTtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcImJ0Qm9keVJlZ2V4OlwiLCBidEJvZHlSZWdleCk7XG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJtYXRjaDpcIiwgdGhpcy5tYXRjaCk7XG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJtYXRjaGVkOlwiLCB0aGlzLm1hdGNoZWQpO1xuXHRcdFx0XHRkbyB7XG5cdFx0XHRcdFx0Y29uc3QgYnRCb2R5ID0gNTc7XG5cdFx0XHRcdFx0Y29uc3QgYnRFeHByU3RhcnQgPSA1Njtcblx0XHRcdFx0XHQvL2NvbnN0IGJ0RXhwckVuZCA9ID8/P1xuXHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJidC1pbnB1dDpcIiwgdGhpcy5faW5wdXQpO1xuXHRcdFx0XHRcdGlmIChpbnB1dE1hdGNoID0gdGhpcy5faW5wdXQubWF0Y2goYnRFeHByUmVnZXgpKSB7XG5cdFx0XHRcdFx0XHRsZXQgYnRFeHByTWF0Y2ggPSBidEV4cHJSZWdleC5leGVjKHRoaXMuX2lucHV0KTtcblx0XHRcdFx0XHRcdGxldCBbXG5cdFx0XHRcdFx0XHRcdGJ0RXhwck9yaWdpbmFsLFxuXHRcdFx0XHRcdFx0XHRidEV4cHJTcGFjZXMsXG5cdFx0XHRcdFx0XHRcdGJ0RXhwclNyYyxcblx0XHRcdFx0XHRcdFx0YnRFeHByTGVmdG92ZXJzXG5cdFx0XHRcdFx0XHRdID0gYnRFeHByTWF0Y2g7XG5cdFx0XHRcdFx0XHQvL2NvbnNvbGUubG9nKFwiYnRFeHByTWF0Y2g6XCIsIGJ0RXhwck1hdGNoKTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJidEV4cHJPcmlnaW5hbDpcIiwgYnRFeHByT3JpZ2luYWwpO1xuXHRcdFx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcImJ0RXhwclNyYzpcIiwgYnRFeHByU3JjKTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJidEV4cHJMZWZ0b3ZlcnM6XCIsIGJ0RXhwckxlZnRvdmVycyk7XG5cdFx0XHRcdFx0XHR0aGlzLnl5LnNjb3BlU3RhdGUuaW5CYWNrdGljayA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0dGhpcy55eS5zY29wZVN0YXRlLmluQmFja3RpY2tFeHByID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGxldCBuZXdFeHByU3JjID0gc2VsZi50cmF2ZXJzZShzZWxmLnBhcnNlKGJ0RXhwclNyYyArIFwiO1wiKSkudHJhbnNsYXRpb24ucmVwbGFjZSgvOyQvLCBcIlwiKTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJwYXJzZSByZXN1bHQ6XCIpO1xuXHRcdFx0XHRcdFx0Ly9jb25zb2xlLmxvZyhuZXdFeHByU3JjKTtcblx0XHRcdFx0XHRcdHRoaXMueXkuc2NvcGVTdGF0ZS5pbkJhY2t0aWNrID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHRoaXMuX2lucHV0ID0gdGhpcy5faW5wdXQucmVwbGFjZShidEV4cHJSZWdleCwgKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHRsZXQgcHJldkNoYXIgPSB0aGlzLm1hdGNoLnN1YnN0cih0aGlzLm1hdGNoLmxlbmd0aCAtMSk7XG5cdFx0XHRcdFx0XHRcdHRoaXMubWF0Y2ggPSBidEV4cHJTcGFjZXMgKyAnJHsnICsgbmV3RXhwclNyYyArIFwifVwiO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcHJldkNoYXIgKyBidEV4cHJMZWZ0b3ZlcnM7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdGZpbmFsTWF0Y2ggKz0gdGhpcy5tYXRjaDtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJhOiB0aGlzLm1hdGNoIGFmdGVyIHJlcGxhY2VtZW50OlwiLCB0aGlzLm1hdGNoKTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJhOiB0aGlzLl9pbnB1dCBhZnRlciByZXBsYWNlbWVudDpcIiwgdGhpcy5faW5wdXQpO1xuXHRcdFx0XHRcdFx0Ly9wcm9jZXNzLmV4aXQoKTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoaW5wdXRNYXRjaCA9IHRoaXMuX2lucHV0Lm1hdGNoKGJ0Qm9keVJlZ2V4KSkge1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX2lucHV0WzBdID09PSBcImBcIikge1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdFx0Ly90aGlzLmlucHV0KCk7XG5cdFx0XHRcdFx0XHRcdC8vdGhpcy55eXRleHQgPSBcImBcIjtcblx0XHRcdFx0XHRcdFx0Ly9yZXR1cm4gdGhpcy5sZXgoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGxldCBtYXRjaCA9IGJ0Qm9keVJlZ2V4LmV4ZWModGhpcy5faW5wdXQpO1xuXHRcdFx0XHRcdFx0dGhpcy5faW5wdXQgPSB0aGlzLl9pbnB1dC5yZXBsYWNlKGJ0Qm9keVJlZ2V4LCAob3JpZ2luYWwsIG1hdGNoLCBsZWZ0b3ZlcnMpID0+IHtcblx0XHRcdFx0XHRcdFx0bGV0IHByZXZDaGFyID0gdGhpcy5tYXRjaC5zdWJzdHIodGhpcy5tYXRjaC5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdFx0dGhpcy5tYXRjaCA9IG1hdGNoO1xuXHRcdFx0XHRcdFx0XHRmaW5hbE1hdGNoICs9IG1hdGNoO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcHJldkNoYXIgKyBsZWZ0b3ZlcnM7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJiOiB0aGlzLm1hdGNoIGFmdGVyIHJlcGxhY2VtZW50OlwiLCB0aGlzLm1hdGNoKTtcblx0XHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJiOiB0aGlzLl9pbnB1dCBhZnRlciByZXBsYWNlbWVudDpcIiwgdGhpcy5faW5wdXQpO1xuXHRcdFx0XHRcdFx0Ly9wcm9jZXNzLmV4aXQoKTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0ZXN0TWF0Y2ggPSB0aGlzLm5leHQoKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSB3aGlsZSgodGVzdE1hdGNoICE9PSBmYWxzZSkgJiYgdGhpcy5pbnB1dCgpKTtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcIm1hdGNoOlwiLCB0aGlzLm1hdGNoKTtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcIm1hdGNoZWQ6XCIsIHRoaXMubWF0Y2hlZCk7XG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJsYXN0TWF0Y2g6XCIsIFwiYFwiICsgZmluYWxNYXRjaCArIFwiYFwiKTtcblx0XHRcdFx0dGhpcy55eS5zY29wZVN0YXRlLmJ0U3RyaW5nID0gXCJgXCIgKyBmaW5hbE1hdGNoICsgXCJgXCI7XG5cdFx0XHRcdHJldHVybiB0ZXN0TWF0Y2g/dGVzdE1hdGNoOmppc29uTGV4ZXIuY2FsbCh0aGlzKTtcblx0XHRcdH1cblx0XHRcdGxldCByZXN1bHQgPSBqaXNvbkxleGVyLmNhbGwodGhpcyk7XG5cdFx0XHQvL2NvbnNvbGUubG9nKFwicmVzdWx0OlwiKTtcblx0XHRcdC8vY29uc29sZS5sb2cocmVzdWx0KTtcblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fTtcblx0XHQqL1xuXHRcdHNlbGYucGFyc2VyLnl5LnNjb3BlQXN0ID0gU2NvcGVBc3Q7XG5cdH1cblxuXHRsaWJyYXJ5VXRpbHMgKCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRydW50aW1lOiByZXF1aXJlKCcuL3Njb3BlUnVudGltZS5qcycpLFxuXHRcdFx0YXBpOiByZXF1aXJlKCcuL3Njb3BlUnVudGltZUFwaS5qcycpXG5cdFx0fTtcblx0fVxuXG5cdHBhcnNlIChjb2RlKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cdFx0bGV0IGppc29uTGV4ZXIgPSBzZWxmLnBhcnNlci5sZXhlci5sZXg7XG5cdFx0c2VsZi5wYXJzZXIueXkuc2NvcGVTdGF0ZSA9IHt9O1xuXHRcdGxldCBidFByb2Nlc3NvciA9IG5ldyBCYWNrdGlja1Byb2Nlc3NvcihzZWxmKTtcblxuXHRcdHNlbGYucGFyc2VyLmxleGVyLmxleCA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdGxldCBjb2RlO1xuXG5cdFx0XHRjb2RlID0gYnRQcm9jZXNzb3IubGV4KHRoaXMpO1xuXHRcdFx0aWYgKGNvZGUgIT09IGZhbHNlKSB7XG5cdFx0XHRcdHJldHVybiBjb2RlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGppc29uTGV4ZXIuY2FsbCh0aGlzKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5wYXJzZXIucGFyc2UoY29kZSk7XG5cdH1cblxuXHR0cmF2ZXJzZSAob2JqKSB7XG5cdFx0Y29uc3Qgc2VsZiA9IHRoaXM7XG5cdFx0bGV0IHJlc3VsdCA9IFwiXCI7XG5cdFx0aWYgKG9iaiA9PT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHRcdGlmICh0eXBlb2Ygb2JqICE9PSBcIm9iamVjdFwiKSB7XG5cdFx0XHRyZXR1cm4gb2JqO1xuXHRcdH1cblx0XHRpZiAob2JqLnR5cGUgPT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cmV0dXJuIG9iajtcblx0XHR9XG5cdFx0aWYgKG9iai5sb2MgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0bGV0IG5hbWUgPSBzZWxmLnJ1bGVzLnN0YXRlLmxvYy5uYW1lO1xuXHRcdFx0c2VsZi5ydWxlcy5zdGF0ZS5sb2MgPSBvYmoubG9jO1xuXHRcdFx0c2VsZi5ydWxlcy5zdGF0ZS5sb2MubmFtZSA9IG5hbWU7XG5cdFx0fVxuXG5cdFx0aWYgKG9iai5ib2R5IGluc3RhbmNlb2YgQXJyYXkpIHtcblx0XHRcdGxldCBsYXN0UGFyZW50ID0gc2VsZi5ydWxlcy5wYXJlbnROb2RlO1xuXHRcdFx0b2JqLnRyYXZlcnNlZEJvZHkgPSBbXTtcblx0XHRcdG9iai5ib2R5LmZvckVhY2goKGkpID0+IHtcblx0XHRcdFx0c2VsZi5ydWxlcy5wYXJlbnROb2RlID0gb2JqLnR5cGU7XG5cdFx0XHRcdG9iai50cmF2ZXJzZWRCb2R5LnB1c2goc2VsZi50cmF2ZXJzZShpKSk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYucnVsZXMucGFyZW50Tm9kZSA9IGxhc3RQYXJlbnQ7XG5cdFx0fVxuXHRcdGlmIChzZWxmLnJ1bGVzW29iai50eXBlXSkge1xuXHRcdFx0c2VsZi5ydWxlcy5zdGF0ZS5zZXROYW1lKG9iai50eXBlKTtcblx0XHRcdGlmIChvYmouYm9keSBpbnN0YW5jZW9mIEFycmF5KSB7XG5cdFx0XHRcdHJldHVybiBzZWxmLnJ1bGVzW29iai50eXBlXSguLi5vYmoudHJhdmVyc2VkQm9keSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLnJ1bGVzLnN0YXRlLmxvYy5zb3VyY2VDb2RlID0gb2JqLmJvZHk7XG5cdFx0XHRcdHJldHVybiBzZWxmLnJ1bGVzW29iai50eXBlXShvYmouYm9keSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGNvbnNvbGUubG9nKGAke29iai50eXBlfSBub3QgaW1wbGVtZW50ZWRgKTtcblx0XHRyZXR1cm4gXCJOb3QgaW1wbGVtZW50ZWRcIjtcblx0fVxuXG5cdGltcG9ydCAoc3JjRmlsZW5hbWUsIGxpYkZpbGVuYW1lLCBmaWxlbmFtZSwgbGluZU9mZnNldCkge1xuXHRcdGxldCBzZWxmID0gdGhpcztcblx0XHRmaWxlbmFtZSA9IEpTT04ucGFyc2UoZmlsZW5hbWUpO1xuXHRcdGxldCBtU3JjRmlsZW5hbWUgPSBwYXRoLnJlc29sdmUocGF0aC5kaXJuYW1lKHNyY0ZpbGVuYW1lKSwgZmlsZW5hbWUpO1xuXHRcdGlmICghZnMuZXhpc3RzU3luYyhtU3JjRmlsZW5hbWUpKSB7XG5cdFx0XHRsZXQgcGFja2FnZXNEaXIgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uL3BhY2thZ2VzXCIpO1xuXHRcdFx0bGV0IHBhY2thZ2VzID0gZnMucmVhZGRpclN5bmMocGFja2FnZXNEaXIpO1xuXHRcdFx0aWYgKHBhY2thZ2VzLmluZGV4T2YoZmlsZW5hbWUpICE9PSAtMSkge1xuXHRcdFx0XHRsZXQgc2NvcGVQYWNrYWdlRGlyID0gcGF0aC5qb2luKHBhY2thZ2VzRGlyLCBmaWxlbmFtZSk7XG5cdFx0XHRcdGxldCBzcG4gPSByZXF1aXJlKHBhdGguam9pbihzY29wZVBhY2thZ2VEaXIsIFwic3BuLmpzb25cIikpO1xuXHRcdFx0XHRsZXQgbWFpbiA9IHBhdGguam9pbihzY29wZVBhY2thZ2VEaXIsIHNwbi5tYWluKTtcblx0XHRcdFx0bVNyY0ZpbGVuYW1lID0gcGF0aC5yZXNvbHZlKHBhdGguZGlybmFtZShzcmNGaWxlbmFtZSksIG1haW4pO1xuXHRcdFx0XHRcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgRmlsZSBcIiR7ZmlsZW5hbWV9XCIgZG9lc24ndCBleGlzdCAke3NlbGYucnVsZXMuc3RhdGUuZXJyb3JUYWlsKCl9YCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmICgvXFwuc2MkLy50ZXN0KG1TcmNGaWxlbmFtZSkpIHtcblx0XHRcdGxldCBtTGliRmlsZW5hbWUgPSBwYXRoLnJlc29sdmUocGF0aC5kaXJuYW1lKGxpYkZpbGVuYW1lKSwgZmlsZW5hbWUucmVwbGFjZSgvXFwuc2MkLywgXCIuanNcIikpO1xuXHRcdFx0bGV0IG1Db2RlID0gZnMucmVhZEZpbGVTeW5jKG1TcmNGaWxlbmFtZSwgJ3V0ZjgnKTtcblx0XHRcdGxldCBtUmVzdWx0ID0gbmV3IFNjb3BlUGFyc2VyKCkudHJhbnNsYXRlKG1Db2RlLCBtU3JjRmlsZW5hbWUsIG1MaWJGaWxlbmFtZSk7XG5cdFx0XHRsZXQgbUxpYkRpcm5hbWUgPSBwYXRoLmRpcm5hbWUobUxpYkZpbGVuYW1lKTtcblx0XHRcdGlmICghZnMuZXhpc3RzU3luYyhtTGliRGlybmFtZSkpIHtcblx0XHRcdFx0ZnMubWtkaXJTeW5jKG1MaWJEaXJuYW1lKTtcblx0XHRcdH1cblx0XHRcdGZzLndyaXRlRmlsZVN5bmMobUxpYkZpbGVuYW1lLCBtUmVzdWx0LmNvZGUpO1xuXHRcdFx0bGV0IGZpbGUgPSB7XG5cdFx0XHRcdHNvdXJjZTogbVJlc3VsdC5jb2RlLFxuXHRcdFx0XHRzb3VyY2VGaWxlOiBtTGliRmlsZW5hbWVcblx0XHRcdH07XG5cdFx0XHRzZWxmLmltcG9ydGVkLnB1c2goe1xuXHRcdFx0XHRmaWxlOiBmaWxlLFxuXHRcdFx0XHRvZmZzZXQ6IHtcblx0XHRcdFx0XHRsaW5lOiBsaW5lT2Zmc2V0XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIGBzY29wZS5pbXBvcnQoJHtKU09OLnN0cmluZ2lmeShtTGliRmlsZW5hbWUpfSlgO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gYHNjb3BlLmltcG9ydCgke0pTT04uc3RyaW5naWZ5KG1TcmNGaWxlbmFtZSl9KWA7XG5cdFx0fVxuXHR9XG5cblx0dHJhbnNsYXRlIChjb2RlLCBzcmNGaWxlbmFtZT1cIk5PIFNPVVJDRSBGSUxFXCIsIGxpYkZpbGVuYW1lPVwiTk8gTElCIEZJTEVcIiwgYXNJbmNsdWRlPWZhbHNlKSB7XG5cdFx0bGV0IHNlbGYgPSB0aGlzO1xuXHRcdGxldCBzY29wZVJ1bnRpbWUgPSBcIlwiO1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiKSB7XG5cdFx0XHRzY29wZVJ1bnRpbWUgKz0gJyMhL3Vzci9iaW4vZW52IG5vZGVcXG4nICtcblx0XHRcdFx0J1widXNlIHN0cmljdFwiOycgK1xuXHRcdFx0XHQnZ2xvYmFsLl9fc2NvcGVkaXI9X19kaXJuYW1lOycgK1xuXHRcdFx0XHQncmVxdWlyZShcInNvdXJjZS1tYXAtc3VwcG9ydFwiKS5pbnN0YWxsKCk7JyArXG5cdFx0XHRcdCdjb25zdCBzY29wZT1yZXF1aXJlKFwiJyArIHBhdGguam9pbihfX2Rpcm5hbWUsIFwic2NvcGVSdW50aW1lLmpzXCIpICsgJ1wiKTsnICtcblx0XHRcdFx0J2NvbnN0IFNjb3BlQXBpPXJlcXVpcmUoXCInICsgcGF0aC5qb2luKF9fZGlybmFtZSwgXCJzY29wZVJ1bnRpbWVBcGkuanNcIikgKyAnXCIpKHNjb3BlKTsnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRzY29wZVJ1bnRpbWUgKz0gJ1widXNlIHN0cmljdFwiOyc7XG5cdFx0fVxuXHRcdC8vbGV0IHNjb3BlUnVudGltZUVycm9ySGFuZGxlciA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oX19kaXJuYW1lLCBcInNjb3BlUnVudGltZUVycm9ySGFuZGxlci5qc1wiKSwgXCJ1dGY4XCIpO1xuXHRcdGxldCByZXN1bHQ7XG5cdFx0bGV0IHRyYXZlcnNhbDtcblx0XHQvL2xldCBzb3VyY2VOb2RlcyA9IFtdO1xuXHRcdC8vbGV0IGxvY3NNYXBwZWQgPSBbXTtcblx0XHRzZWxmLm1hcEFuZFBhcnNlID0gKGRhdGEgPSB7c291cmNlOlwiXCIsIHRyYW5zbGF0aW9uOlwiXCIsIHNuOiBcIlwifSkgPT4ge1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhkYXRhLnNvdXJjZSk7XG5cdFx0XHQvL2xldCBsb2MgPSBzZWxmLnJ1bGVzLnN0YXRlLmxvYy5zdGFydDtcblx0XHRcdC8vY29uc29sZS5sb2coc2VsZi5ydWxlcy5zdGF0ZS5nZXROYW1lKCkpO1xuXHRcdFx0aWYgKHR5cGVvZiBkYXRhLnNuICE9PSBcInN0cmluZ1wiKSB7XG5cdFx0XHRcdGRhdGEuc24uc2V0U291cmNlQ29udGVudChzcmNGaWxlbmFtZSwgZGF0YS5zb3VyY2UpO1xuXHRcdFx0fVxuXHRcdFx0Ly9zb3VyY2VOb2Rlcy5wdXNoKHNuKTtcblx0XHRcdC8vY29uc29sZS5sb2coZGF0YS5zb3VyY2UsIGxvYyk7XG5cdFx0XHRyZXR1cm4gZGF0YTtcblx0XHR9O1xuXHRcdHNlbGYuc24gPSAoY2h1bmssIG5hbWU9c2VsZi5ydWxlcy5zdGF0ZS5nZXROYW1lKCkpID0+IHtcblx0XHRcdGxldCBsb2MgPSBzZWxmLnJ1bGVzLnN0YXRlLmxvYy5zdGFydDtcblx0XHRcdC8vY29uc29sZS5sb2coXCJjaHVuazpcIiwgY2h1bmspO1xuXHRcdFx0cmV0dXJuIG5ldyBzb3VyY2VNYXAuU291cmNlTm9kZShcblx0XHRcdFx0bG9jLmxpbmUsIFxuXHRcdFx0XHRsb2MuY29sdW1uLCBcblx0XHRcdFx0c3JjRmlsZW5hbWUsIFxuXHRcdFx0XHRjaHVuayxcblx0XHRcdFx0bmFtZVxuXHRcdFx0KTtcblx0XHR9O1xuXHRcdGxldCBub2RlID0gc2VsZi5zbihcIlwiKTtcblx0XHRsZXQgc207XG5cdFx0c2VsZi5pbXBvcnRlZCA9IFtdO1xuXHRcdHNlbGYucnVsZXMgPSBuZXcgU2NvcGVSdWxlcygpO1xuXHRcdHNlbGYucnVsZXMucGFyc2VyID0gc2VsZjtcblx0XHRzZWxmLnJ1bGVzLnNyY0ZpbGVuYW1lID0gc3JjRmlsZW5hbWU7XG5cdFx0c2VsZi5ydWxlcy5saWJGaWxlbmFtZSA9IGxpYkZpbGVuYW1lO1xuXHRcdHNlbGYucnVsZXMubm9kZSA9IG5vZGU7XG5cdFx0c2VsZi5ydWxlcy5zbiA9IHNlbGYuc247XG5cdFx0c2VsZi5ydWxlcy5tYXBBbmRQYXJzZSA9IHNlbGYubWFwQW5kUGFyc2U7XG5cdFx0bGV0IGFzdCA9IHRoaXMucGFyc2UoY29kZSk7XG5cdFx0bGV0IGFzdEpTT04gPSBKU09OLnN0cmluZ2lmeShhc3QsIG51bGwsICcgICcpO1xuXHRcdGxldCBwYXJzZVJlc3VsdCA9IHNlbGYudHJhdmVyc2UoYXN0KTtcblx0XHQvL3Njb3BlUnVudGltZSA9IGJhYmVsQ29yZS50cmFuc2Zvcm0oc2NvcGVSdW50aW1lLCB7cHJlc2V0czogWydtaW5pZnktZXMyMDE1J119KTtcblx0XHQvL2NvbnNvbGUubG9nKHNjb3BlUnVudGltZSk7XG5cdFx0aWYgKGFzSW5jbHVkZSkge1xuXHRcdFx0cmV0dXJuIHNlbGYucnVsZXMuaW52b2tlRXhwcmVzc2lvbihcblx0XHRcdFx0XHRzZWxmLnJ1bGVzLnNjb3BlRXhwcmVzc2lvbihcblx0XHRcdFx0XHRcdHBhcnNlUmVzdWx0XG5cdFx0XHRcdFx0KSxcblx0XHRcdFx0XHRzZWxmLnJ1bGVzLmludm9rZUFyZ3VtZW50cygpXG5cdFx0XHRcdCkuc25cblx0XHR9IGVsc2Uge1xuXHRcdFx0dHJhdmVyc2FsID0gc2VsZi5ydWxlcy5pbnZva2VFeHByZXNzaW9uKFxuXHRcdFx0XHRzZWxmLnJ1bGVzLnNjb3BlRXhwcmVzc2lvbihcblx0XHRcdFx0XHRzZWxmLnJ1bGVzLnNjb3BlU3RhcnQoKSxcblx0XHRcdFx0XHRwYXJzZVJlc3VsdFxuXHRcdFx0XHQpLFxuXHRcdFx0XHRzZWxmLnJ1bGVzLmludm9rZUFyZ3VtZW50cygpXG5cdFx0XHQpLnNuO1xuXG5cdFx0XHR0cmF2ZXJzYWwucHJlcGVuZChbXG5cdFx0XHRcdHNjb3BlUnVudGltZSxcblx0XHRcdFx0Ly9zY29wZVJ1bnRpbWVFcnJvckhhbmRsZXIsXG5cdFx0XHRcdFwibW9kdWxlLmV4cG9ydHM9XCJcblx0XHRcdF0pO1xuXHRcdFx0dHJhdmVyc2FsLmFkZChbXCI7XCJdKTtcblx0XHR9XG5cdFx0c20gPSB0cmF2ZXJzYWwudG9TdHJpbmdXaXRoU291cmNlTWFwKCk7XG5cdFx0c20ubWFwID0gSlNPTi5wYXJzZShzbS5tYXAudG9TdHJpbmcoKSk7XG5cdFx0c20ubWFwLnNvdXJjZXNDb250ZW50ID0gW2NvZGVdO1xuXHRcdHNtLmNvbW1lbnQgPSBjb252ZXJ0LmZyb21PYmplY3Qoc20ubWFwKS50b0NvbW1lbnQoKTtcblx0XHRsZXQgbWFpbkZpbGUgPSB7XG5cdFx0XHRzb3VyY2U6IHNtLmNvZGUgKyBgXFxuJHtzbS5jb21tZW50fWAsXG5cdFx0XHRzb3VyY2VGaWxlOiBsaWJGaWxlbmFtZVxuXHRcdH07XG5cdFx0bGV0IGNvbWJpbmF0aW9uID0gY29tYmluZS5cblx0XHRcdGNyZWF0ZShsaWJGaWxlbmFtZS5yZXBsYWNlKC9cXC5qcyQvLCBcIi5taW4uanNcIikpLlxuXHRcdFx0YWRkRmlsZShtYWluRmlsZSwge2xpbmU6IDF9KTtcblx0XHRcblx0XHRzZWxmLmltcG9ydGVkLmZvckVhY2gobyA9PiB7XG5cdFx0XHRjb21iaW5hdGlvbi5hZGRGaWxlKG8uZmlsZSwgby5vZmZzZXQpO1xuXHRcdH0pO1xuXHRcdGxldCBiYXNlNjQgPSBjb21iaW5hdGlvbi5iYXNlNjQoKTtcblx0XHRsZXQgbmV3U20gPSBjb252ZXJ0LmZyb21CYXNlNjQoYmFzZTY0KS50b09iamVjdCgpO1xuXHRcdHJlc3VsdCA9IHtcblx0XHRcdGFzdDogYXN0SlNPTixcblx0XHRcdG1hcDogbmV3U20sXG5cdFx0XHRjb2RlOiBzbS5jb2RlICsgYFxcbiR7c20uY29tbWVudH1gXG5cdFx0fTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU2NvcGVQYXJzZXI7Il19